<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=5377&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="图像读取 1 2 3 4 5 6 7 8 9 10 11 12 # 导包 import cv2 import numpy as np from numpy.ma import hstack# 用于横向拼接图片 from numpy.ma import vstack# 用于纵向拼接图片 def cv_show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/plane.jpg&#34;) image2 = cv2.imread(&#34;./pictures/plane.jpg&#34;,cv2.IMREAD_GRAYSCALE) cv_show(image2) 视频读取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import cv2 import numpy as np vc = cv2.VideoCapture(r&#34;C:\\Users\\zhenq\\Videos\\03.mp4&#34;) # 图像的读取 # 异常处理 if vc.isOpened(): oepn,frame = vc.read() else: open = False # 使用循环体对每一帧图像进行读取 while open: ret,frame=vc.read() # frame位置是帧，如果视频没有了，frame变为None,视频退出播放 if frame is None: break # ret 表示程序能否读取视频 if ret == True: cv2.imshow(&#34;这是一个测试&#34;,cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY))# 对每一帧进行灰度处理 if cv2.waitKey(10)&amp;0xFF==27: # 程序等待10毫秒，在这个时间内检测用户键盘输入，esc的ASCII码是27.检测后进入下一次的while循环 break vc.release() cv2.destroyAllWindows() 图像的灰度处理、截取、颜色通道的提取、调整大小与融合、阈值 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 import cv2 import numpy as np def cv_show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 图像的灰度处理方法一：在imread中添加相关参数，这钟方法不建议使用，此处不再写 # 图像的灰度处理方法二：将传入的图像进行二次处理,这种方法可以分别得到原图和灰度图，方便展示 image = cv2.imread(r&#34;./pictures/GEM.png&#34;) image_gray = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY) &#34;&#34;&#34; 截取图像，在使用imread后，得到的是一个矩阵（或者说是一个list[]列表），可以使用切片的方法从里面得到部分数据 对于BGR彩色图，这个list是一个&#34;[[[B,G,R]]]&#34;,比如下面这个3*3的图片 [[[ 62 62 62] [ 56 56 56] [ 33 33 33]] [[126 126 126] [ 58 58 58] [ 57 57 57]] [[ 61 61 61] [ 94 94 94] [217 217 217]]] 可以横向进行表示，更容易理解： [[[ 62 62 62],[ 56 56 56],[ 33 33 33]] [[126 126 126],[ 58 58 58],[ 57 57 57]] [[ 61 61 61],[ 94 94 94],[217 217 217]]] list[0:2]可以把0行、1行拿出来，也就是列表中的第一行和第二行 list[0:2][0:1]可以把列表中前两行、第一列列拿出来。当然了list[0:2,0:1]和list[0:2][0:1]是一样的。 进一步的说[0:2]是图片的高，[0:1]是图片的宽。在cv2中图像的坐标原点在左上角，水平方向是w轴，竖直方向是h，要理解图像和矩阵之间的转换关系。 每一个像素点由三个数字表示；对于灰度图，一个数字就可以表示一个像素点。 &#34;&#34;&#34; # 在理解了图像和矩阵或者说列表之间的关系，下面的就很好理解了。对列表进行三次切片可以得到相应的BGR颜色值。 #只保留R.注意在cv2中顺序是BGR，不是RGB image[:,:,0]=0 image[:,:,1]=0 &#34;&#34;&#34; cv2.resize(image1,(100,100)) #调整大小为100*100 cv2.resize(image1,(0,0),fx=2,fy=2) #图像沿着x方向y方向进行拉伸 cv2.addWeighted(image,0.5,image1,0.5,0) #res=A*image+B*image1+C,在这里A,B,C分别是0.5，0.5，0 &#34;&#34;&#34; 边界填充 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(image): cv2.imshow(&#34;this is a top&#34;,image) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(r&#34;./pictures/03.png&#34;)# 图片大小(746, 1374, 3) # 为了进行边界填充，首先将图片进行切割。 image2 = image1[0:512,0:512] # 边界填充 top,bottom,left,right =(100,100,100,100) # 1.replicate法填充 replicate = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REPLICATE) # 2.reflect 法填充 reflect = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REFLECT) # 3.reflect101 法填充 reflect101 = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REFLECT_101) # 4.wrap法填充 wrap = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_WRAP) # 5.constant法填充 constant = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_CONSTANT,value=0) #图片展示，其中&#34;231&#34;，2表示总行数；3表示总列数；1表示这六个位置中的第一个位置。 plt.figure(figsize=(10, 6)) plt.subplot(231),plt.imshow(replicate),plt.title(&#39;replicate法填充&#39;) plt.subplot(232),plt.imshow(reflect),plt.title(&#39;reflect法填充&#39;) plt.subplot(233),plt.imshow(reflect101),plt.title(&#39;reflect101法填充&#39;) plt.subplot(234),plt.imshow(wrap),plt.title(&#39;wrap法填充&#39;) plt.subplot(235),plt.imshow(constant),plt.title(&#39;constant法填充&#39;) plt.show(plt) 数值计算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import numpy as np import cv2 import matplotlib.pyplot as plt def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(r&#34;./pictures/opencv_logo.jpg&#34;) image2 = cv2.imread(r&#34;./pictures/plane.jpg&#34;) image = image2[0:250,0:250] # 使image与image1大小相同，以保证矩阵能正常进行运算 def fun1(): image = image2[0:250,0:250] cv2.imshow(&#34;6&#34;,image+100) # 将矩阵中的每一个数字加100 cv2.imshow(&#34;6&#34;,image+image1) # 大小相同的两个矩阵相加，超过255的部分取余数 cv2.add(image1,image) #大小相同的两个矩阵相加，超过255的统一取为255 cv2.waitKey(0) cv2.destroyAllWindows() 图像平滑处理（滤波处理） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/bad.png&#34;,cv2.IMREAD_GRAYSCALE) # 均值滤波 cvshow1 = cv2.blur(image1,(3,3)) # 方框滤波 cvshow2=cv2.boxFilter(image1,-1,(3,3),normalize=True)# 效果同上均值滤波 cvshow3=cv2.boxFilter(image1,-1,(3,3),normalize=False)# 越界了 # 高斯滤波 cvshow4=cv2.GaussianBlur(image1,(3,3),1) # 中值滤波 cvshow5=cv2.medianBlur(image1,5) plt.figure(figsize=(15, 6)) plt.subplot(231),plt.imshow(cvshow1, cmap=&#39;gray&#39;),plt.title(&#39;均值滤波&#39;) plt.subplot(232),plt.imshow(cvshow2, cmap=&#39;gray&#39;),plt.title(&#39;方框滤波_normalize=True&#39;) plt.subplot(233),plt.imshow(cvshow3, cmap=&#39;gray&#39;),plt.title(&#39;方框滤波_normalize=False&#39;) plt.subplot(234),plt.imshow(cvshow4, cmap=&#39;gray&#39;),plt.title(&#39;高斯滤波&#39;) plt.subplot(235),plt.imshow(cvshow5, cmap=&#39;gray&#39;),plt.title(&#39;中值滤波&#39;) plt.show(plt) 腐蚀与膨胀及其组合（开运算、闭运算、梯度运算、礼帽与黑帽） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() &#34;&#34;&#34; 腐蚀与膨胀操作用于处理二值化的图像，由于大多数图片都是BGR三色的 下面写一个函数，将BGR图片处理为二值化图片 &#34;&#34;&#34; def img_twonum(image1): image = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY)#确保图像是灰度图 ret,dst=cv2.threshold(image,127,255,cv2.THRESH_BINARY) return dst image1 = cv2.imread(r&#34;./pictures/fushi.png&#34;) image2 = img_twonum(image1) kernel = np.ones((5,5),np.uint8) #用 NumPy 库创建一个 5x5 的全1矩阵（内核/结构元素），数据类型为无符号8位整数（取值范围 0-255） erosion = cv2.erode(image2,kernel,iterations=1) # 腐蚀 # 最后的参数表示迭代次数 dilt = cv2.dilate(image2,kernel,iterations=1) # 膨胀 opening = cv2.morphologyEx(image2,cv2.MORPH_OPEN,kernel) # 开运算:先腐蚀再膨胀 close = cv2.morphologyEx(image2,cv2.MORPH_CLOSE,kernel) # 闭运算:先膨胀再腐蚀 gradient = cv2.morphologyEx(image2,cv2.MORPH_GRADIENT,kernel) # 梯度运算= 膨胀-腐蚀。得到边缘信息 tophat = cv2.morphologyEx(image2,cv2.MORPH_TOPHAT,kernel) # 礼帽= 原始输入-开运算 得到的是刺 blackhat = cv2.morphologyEx(image2,cv2.MORPH_BLACKHAT,kernel) # 黑帽 = 闭运算-原始输入 得到的是主体大概的轮廓 plt.figure(figsize=(15, 6)) plt.subplot(241),plt.imshow(erosion, cmap=&#39;gray&#39;),plt.title(&#39;腐蚀&#39;) plt.subplot(242),plt.imshow(dilt, cmap=&#39;gray&#39;),plt.title(&#39;膨胀&#39;) plt.subplot(243),plt.imshow(opening, cmap=&#39;gray&#39;),plt.title(&#39;开运算:先腐蚀再膨胀&#39;) plt.subplot(244),plt.imshow(close, cmap=&#39;gray&#39;),plt.title(&#39;闭运算:先膨胀再腐蚀&#39;) plt.subplot(245),plt.imshow(gradient, cmap=&#39;gray&#39;),plt.title(&#39;梯度运算= 膨胀-腐蚀&#39;) plt.subplot(246),plt.imshow(tophat, cmap=&#39;gray&#39;),plt.title(&#39;礼帽=原始输入-开运算&#39;) plt.subplot(247),plt.imshow(blackhat, cmap=&#39;gray&#39;),plt.title(&#39;黑帽=闭运算-原始输入&#39;) plt.show(plt) 图像梯度计算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False &#34;&#34;&#34; 求梯度多用于灰度图片 但是不建议把dx,dx同时设置为1别计算，应该把dx、dy分开求出来，再进行融合 &#34;&#34;&#34; def cvshow(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() def juedui(*args): # 用于矩阵求绝对值 img = cv2.convertScaleAbs(*args) return img image1 = cv2.imread(&#34;./pictures/pie.png&#34;,cv2.IMREAD_GRAYSCALE) # sobel算子,分别计算x和y方向的一阶梯度，合并后显示边缘 sobelx = cv2.Sobel(image1,cv2.CV_64F,1,0,ksize=3) sobely = cv2.Sobel(image1,cv2.CV_64F,0,1,ksize=3) # scharr算子,类似Sobel，但对边缘更敏感 scharrx = cv2.Scharr(image1,cv2.CV_64F,1,0) scharry = cv2.Scharr(image1,cv2.CV_64F,0,1) # Laplacian算子,显示二阶导数边缘，通常比一阶算子对噪声更敏感，边缘更细,不能分开求 laplacian = cv2.Laplacian(image1,cv2.CV_64F,ksize=3) # 分别对每个梯度图像求绝对值 sobelx = cv2.convertScaleAbs(sobelx) sobely = cv2.convertScaleAbs(sobely) scharrx = cv2.convertScaleAbs(scharrx) scharry = cv2.convertScaleAbs(scharry) laplacian = cv2.convertScaleAbs(laplacian) # 求两个方向的梯度 sobelxy = cv2.addWeighted(sobelx,0.5,sobely,0.5,0) scharrxy = cv2.addWeighted(scharrx,0.5,scharry,0.5,0) plt.figure(figsize=(15, 2)) plt.subplot(131),plt.imshow(sobelxy, cmap=&#39;gray&#39;),plt.title(&#39;sobel算子&#39;) plt.subplot(132),plt.imshow(scharrxy, cmap=&#39;gray&#39;),plt.title(&#39;scharr算子,类似Sobel，但对边缘更敏感&#39;) plt.subplot(133),plt.imshow(laplacian, cmap=&#39;gray&#39;),plt.title(&#39;Laplacian算子,显示二阶导数边缘&#39;) plt.show() canny边缘检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import numpy as np import cv2 import matplotlib.pyplot as plt image1 = cv2.imread(&#34;./pictures/bad.png&#34;,cv2.IMREAD_GRAYSCALE) v1= cv2.Canny(image1,10,150) # 分别指的是maxval,minval v2= cv2.Canny(image1,30,150) v3= cv2.Canny(image1,50,150) v4= cv2.Canny(image1,50,51) v5= cv2.Canny(image1,50,100) v6= cv2.Canny(image1,50,200) v7= cv2.Canny(image1,145,150) v8= cv2.Canny(image1,200,201) plt.figure(figsize=(15, 6)) plt.subplot(241),plt.imshow(v1, cmap=&#39;gray&#39;),plt.title(&#39;canny_10*150&#39;) plt.subplot(242),plt.imshow(v2, cmap=&#39;gray&#39;),plt.title(&#39;canny_30*150&#39;) plt.subplot(243),plt.imshow(v3, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*150&#39;) plt.subplot(244),plt.imshow(v4, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*51&#39;) plt.subplot(245),plt.imshow(v5, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*100&#39;) plt.subplot(246),plt.imshow(v6, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*200&#39;) plt.subplot(247),plt.imshow(v7, cmap=&#39;gray&#39;),plt.title(&#39;canny_145*150&#39;) plt.subplot(248),plt.imshow(v8, cmap=&#39;gray&#39;),plt.title(&#39;canny_200*201&#39;) plt.show() 图像金字塔 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 高斯金字塔 image1 = cv2.imread(r&#34;./pictures/AM.png&#34;,cv2.IMREAD_GRAYSCALE) up1 =cv2.pyrUp(image1) #图像变大 up2 =cv2.pyrDown(image1) #图像变大小 # 拉普拉斯金字塔 def laplasi(): image1 = cv2.imread(r&#34;./pictures/AM.png&#34;, cv2.IMREAD_GRAYSCALE) down = cv2.pyrDown(image1) down_up = cv2.pyrUp(down) image = image1-down_up # 这个拉普拉斯金字塔只迭代了1次 image1 = cv2.imread(r&#34;./pictures/AM.png&#34;, cv2.IMREAD_GRAYSCALE) for i in range(0,1): # 这里可以设置迭代次数 down = cv2.pyrDown(image1) down_up = cv2.pyrUp(down) image1 = image1-down_up plt.subplot(131),plt.imshow(up1,cmap=&#39;gray&#39;),plt.title(&#39;高斯金字塔_up&#39;) plt.subplot(132),plt.imshow(up2,cmap=&#39;gray&#39;),plt.title(&#39;高斯金字塔_down&#39;) plt.subplot(133),plt.imshow(image1,cmap=&#39;gray&#39;),plt.title(&#39;拉普拉斯金字塔&#39;) plt.show() 图像轮廓 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/cars.jpg&#34;) gray = cv2.cvtColor(image1,cv2.COLOR_BGR2GRAY) a,image1_1 = cv2.threshold(gray,127,255,cv2.THRESH_BINARY) binary,contours,hierarchy = cv2.findContours(image1_1,cv2.RETR_TREE,cv2.CHAIN_APPROX_NONE) # 绘制轮廓 drawimage = image1.copy() # ###注意不要对原图进行操作 res = cv2.drawContours(drawimage,contours,-1,(0,0,255),2) res_rgb = cv2.cvtColor(res, cv2.COLOR_BGR2RGB) # 关键步骤：BGR转RGB plt.subplot(),plt.imshow(res_rgb),plt.title(&#39;绘制轮廓&#39;) plt.show() # 进一步可以调用轮廓的各种特征 轮廓近似 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import numpy as np import cv2 from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() import cv2 from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/lunkuo.png&#34;) # 图像预处理 gray1 = cv2.cvtColor(image1,cv2.COLOR_BGR2GRAY) a,image2 = cv2.threshold(gray1,127,255,cv2.THRESH_BINARY) binary,contours,hierarchy = cv2.findContours(image2,cv2.RETR_TREE,cv2.CHAIN_APPROX_NONE) cont = contours[0] #检测到的第一个轮廓 epsilon = 0.1*cv2.arcLength(cont,True) approx = cv2.approxPolyDP(cont,epsilon,True) image3 = image1.copy() res = cv2.drawContours(image3,[approx],-1,(0,0,255),2) # 外接矩形 x,y,w,h = cv2.boundingRect(cont) image4 = image1.copy() image4 = cv2.rectangle(image4,(x,y),(x+w,y+h),(0,0,255),2) # 外接圆 (x,y),radius = cv2.minEnclosingCircle(cont) center = (int(x),int(y)) radius= int(radius) image5 = cv2.circle(image1,center,radius,(0,0,255),2) image = hstack((res,image4,image5)) cvshow(image) 图像匹配 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 import numpy as np import cv2 from cv2 import TM_CCORR, TM_CCORR_NORMED, TM_SQDIFF, TM_SQDIFF_NORMED from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/GEM.png&#34;,0) image2=cv2.imread(r&#34;./pictures/GEM_face.png&#34;,0) image3 = image1.copy() h,w = image2.shape[:2] &#34;&#34;&#34; cv2.IMREAD_COLOR (1)：加载彩色图像，忽略透明度。 cv2.IMREAD_GRAYSCALE (0)：以灰度模式加载图像。 cv2.IMREAD_UNCHANGED (-1)：加载图像包含alpha通道。 &#34;&#34;&#34; res = cv2.matchTemplate(image1,image2,TM_CCORR_NORMED) a,b,c,d = cv2.minMaxLoc(res) youxia = (d[0]+w,d[1]+h) image = cv2.rectangle(image3,d,youxia,(0,255,0),2) cvshow(image) 直方图 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 %matplotlib inline import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image1 = cv2.imread(&#34;./pictures/GEM.png&#34;) image1_gray = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY) # 计算灰度直方图（OpenCV方式） hist = cv2.calcHist([image1_gray], [0], None, [256], [0, 256]) # 将直方图数据转换为可绘制的形式 plt.figure(figsize=(10, 2)) plt.plot(hist, color=&#39;blue&#39;) # 用曲线绘制直方图 # 或使用柱状图： # plt.bar(range(256), hist.ravel(), color=&#39;gray&#39;, width=1.0) # 设置图表属性 plt.title(&#34;灰度直方图（基于cv2.calcHist）&#34;),plt.xlabel(&#34;像素值 (0-255)&#34;),plt.ylabel(&#34;频次&#34;),plt.xlim([0, 255]) # 限制X轴范围 plt.grid(alpha=1) # 表示网格线是半透明的（30% 不透明） plt.show() # 分别统计这张彩色图的b、g、r plt.figure(figsize=(10, 2)) color = (&#39;b&#39;,&#39;g&#39;,&#39;r&#39;) # 通过for循环，将不同颜色进行统计，绘制在三张图上，最后将三张图统一展示。 for i, col in enumerate(color): # enumerate可以同时得到索引和数据 hist = cv2.calcHist([image1], [i], None, [256], [0, 256]) plt.plot(hist, color=col) plt.xlim([0, 256]) plt.show() musk的使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 %matplotlib inline import numpy as np import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image= cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE) musk = np.zeros(image.shape[:2],np.uint8) musk[100:300,100:400] = 255 # 把保存的东西设置为255 hist = cv2.calcHist([image],[0],musk,[256],[0,256]) plt.figure(figsize=(10, 2)) plt.plot(hist) plt.xlim([0,256]) plt.show() 均衡化与自适应均衡化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import numpy as np import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image= cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE) musk = np.zeros(image.shape[:2],np.uint8) musk[100:300,100:400] = 255 hist = cv2.calcHist([image],[0],musk,[256],[0,256]) a = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8,8)) res_clahe = a.apply(image) equ = cv2.equalizeHist(image) plt.figure(figsize=(8, 2)) plt.subplot(122),plt.imshow(res_clahe,cmap=&#39;gray&#39;),plt.title(&#34;自适应均衡化&#34;) plt.subplot(121),plt.imshow(equ,cmap=&#39;gray&#39;),plt.title(&#34;均衡化&#34;) plt.show() 低通与高通滤波 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import cv2 import numpy as np import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image = cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE)#读取图像 image_float32 = np.float32(image) # 转化格式为np.float32 a = cv2.dft(image_float32, flags=cv2.DFT_COMPLEX_OUTPUT) # 进行频域变化 a_shift = np.fft.fftshift(a) # 将低频值放到中心处 img2 = 20*np.log(cv2.magnitude(a_shift[:,:,0], a_shift[:,:,1])) # 转化为灰度图可以展示的图像 rows, cols = image.shape crow, ccol = int(rows / 2), int(cols / 2) # 低通滤波器(会使得图像变模糊) musk = np.zeros((rows, cols,2),np.uint8) musk[crow-30:crow+30, ccol-30:ccol+30] = 1 # IDFT fshift = a_shift*musk f_shift = np.fft.ifftshift(fshift) # 还原这一步操作：“将低频值放到中心处” img = cv2.idft(f_shift) img = cv2.magnitude(img[:,:,0], img[:,:,1]) # 把实部与虚部分开 # 高通滤波器 musk2 = np.ones((rows, cols,2),np.uint8) musk2[crow-30:crow+30, ccol-30:ccol+30] = 0 fshift2 = a_shift*musk2 f_shift2 = np.fft.ifftshift(fshift2) img2 = cv2.idft(f_shift2) img2 = cv2.magnitude(img2[:,:,0], img2[:,:,1]) plt.subplot(221),plt.imshow(img2, cmap=&#39;gray&#39;),plt.title(&#34;频域图&#34;) plt.subplot(222),plt.imshow(image, cmap=&#39;gray&#39;),plt.title(&#34;原始图像&#34;) plt.subplot(223),plt.imshow(img, cmap=&#39;gray&#39;),plt.title(&#34;低通滤波器&#34;) plt.subplot(224),plt.imshow(img2, cmap=&#39;gray&#39;),plt.title(&#34;高通滤波器&#34;) plt.show() 角点检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image = cv2.imread(&#34;./pictures/guojixiangqi_qipan.jpg&#34;) image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) image_gray_32 = np.float32(image_gray) # ！！！注意要求把灰度图转化为np.float32格式的，这很重要！！！ dst = cv2.cornerHarris(image_gray_32, 2, 3, 0.04) # 固定用法 image[dst &gt; 0.01 * dst.max()] = [0, 0, 255] # 固定用法，用于筛选出响应值大于最大响应值 1% 的像素点，这些像素点被认为是角点 plt.imshow(image),plt.title(&#34;角点检测&#34;) plt.show() .SIFT函数检测特征点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 图像读取与预处理 image = cv2.imread(&#34;./pictures/GEM.png&#34;) image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) # 得到特征点（key points） sift = cv2.xfeatures2d.SIFT_create() kp = sift.detect(image_gray, None) # 传入的是灰度图 # 绘制特征点 image = cv2.drawKeypoints(image_gray, kp, image, color=(0, 255, 0)) # 输出图片 plt.subplot(),plt.imshow(image, cmap=&#39;gray&#39;),plt.title(&#34;SIFT特征点&#34;),plt.show() # 计算特征 kp,des = sift.compute(image_gray, kp) print(np.array(kp).shape) # 特征点的个数 print(des.shape) # 每一个特征点都是一个128维的向量 print(des[0]) # 每一个特征点都是一个128维的向量，可以数一下是128维 Brute-Force蛮力匹配 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 %matplotlib inline import numpy as np import matplotlib.pyplot as plt import cv2 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/GEM_face.png&#34;) image2 = cv2.imread(&#34;./pictures/GEM.png&#34;) sift = cv2.xfeatures2d.SIFT_create() kp1, des1 = sift.detectAndCompute(image1, None) # 找到特征点与特征向量 kp2, des2 = sift.detectAndCompute(image2, None) # 找到特征点与特征向量 bf1 = cv2.BFMatcher(crossCheck=True) # 1对1的匹配 matches = bf1.match(des1, des2) matches = sorted(matches, key=lambda x: x.distance) image3 = cv2.drawMatches(image1, kp1, image2, kp2, matches[:10], None, flags=2) # k对最佳匹配 bf2 = cv2.BFMatcher() matches2 = bf2.knnMatch(des1,des2,2) good = [] for m, n in matches2: if m.distance &lt; 0.75*n.distance: good.append(m) image4 = cv2.drawMatches(image1, kp1, image2, kp2, good, None, flags=2) # 展示图片 image3_rgb = image3[:, :, ::-1] # 把BGR图片转化为RGB图片 image4_rgb = image4[:, :, ::-1] # 把BGR图片转化为RGB图片 plt.subplot(221),plt.imshow(image3_rgb),plt.title(&#34;1对1的匹配&#34;) plt.subplot(222),plt.imshow(image4_rgb),plt.title(&#34;k对最佳匹配&#34;) plt.show() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False imageA = cv2.imread(&#34;./pictures/p1.png&#34;) imageB = cv2.imread(&#34;./pictures/p2.png&#34;) gray1 = cv2.cvtColor(imageA, cv2.COLOR_BGR2GRAY) gray2 = cv2.cvtColor(imageB, cv2.COLOR_BGR2GRAY) sift = cv2.xfeatures2d.SIFT_create() kpsA,dpA = sift.detectAndCompute(gray1, None) kpsB,dpB = sift.detectAndCompute(gray2, None) bf = cv2.BFMatcher() matches = bf.knnMatch(dpA,dpB,2) good = [] for m in matches: if len(m) == 2 and m[0].distance &lt; m[1].distance * 0.75: good.append((m[0].queryIdx,m[0].trainIdx)) kps1 = np.float32([kp.pt for kp in kpsA]) kps2 = np.float32([kp.pt for kp in kpsB]) kps1 = np.float32([kps1[a[0]] for a in good]) kps2 = np.float32([kps2[a[1]] for a in good]) M,status = cv2.findHomography(kps2,kps1,cv2.RANSAC,4.0) result = cv2.warpPerspective(imageB, M, (imageA.shape[1]+imageB.shape[1],imageA.shape[0])) result[0:imageA.shape[0],0:imageA.shape[1]] = imageA # 计算变换后的图像B的边界 h, w = imageB.shape[:2] corners = np.array([[0, 0], [0, h-1], [w-1, h-1], [w-1, 0]], dtype=np.float32) warped_corners = cv2.perspectiveTransform(corners.reshape(1, -1, 2), M).reshape(-1, 2) # 计算输出画布的最小包围矩形 all_corners = np.concatenate((warped_corners, np.array([[0,0], [imageA.shape[1], imageA.shape[0]]])), axis=0) x_min, y_min = np.floor(np.min(all_corners, axis=0)).astype(int) x_max, y_max = np.ceil(np.max(all_corners, axis=0)).astype(int) # 计算平移变换矩阵 offset_x = -x_min offset_y = -y_min translation_matrix = np.array([[1, 0, offset_x], [0, 1, offset_y], [0, 0, 1]]) # 调整单应性矩阵并执行透视变换 adjusted_homography = translation_matrix.dot(M) result = cv2.warpPerspective(imageB, adjusted_homography, (x_max - x_min, y_max - y_min)) # 创建新的拼接画布 result[offset_y:offset_y+imageA.shape[0], offset_x:offset_x+imageA.shape[1]] = imageA # 自动裁剪黑边 gray = cv2.cvtColor(result, cv2.COLOR_BGR2GRAY) _, thresh = cv2.threshold(gray, 1, 255, cv2.THRESH_BINARY) _,contours, _ = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE) x,y,w,h = cv2.boundingRect(contours[0]) final = result[y:y+h, x:x+w] # 展示图片 final_rgb = final[:, :, ::-1] # 把BGR图片转化为RGB图片 imageA_rgb = imageA[:, :, ::-1]# 把BGR图片转化为RGB图片 imageB_rgb = imageB[:, :, ::-1]# 把BGR图片转化为RGB图片 plt.subplot(131),plt.imshow(imageA_rgb),plt.title(&#34;左边的图片&#34;) plt.subplot(132),plt.imshow(imageB_rgb),plt.title(&#34;右边的图片&#34;) plt.subplot(133),plt.imshow(final_rgb),plt.title(&#34;拼接后的图片&#34;) plt.show() ">
<title>opencv学习笔记</title>

<link rel='canonical' href='http://localhost:5377/p/opencv%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="opencv学习笔记">
<meta property='og:description' content="图像读取 1 2 3 4 5 6 7 8 9 10 11 12 # 导包 import cv2 import numpy as np from numpy.ma import hstack# 用于横向拼接图片 from numpy.ma import vstack# 用于纵向拼接图片 def cv_show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/plane.jpg&#34;) image2 = cv2.imread(&#34;./pictures/plane.jpg&#34;,cv2.IMREAD_GRAYSCALE) cv_show(image2) 视频读取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import cv2 import numpy as np vc = cv2.VideoCapture(r&#34;C:\\Users\\zhenq\\Videos\\03.mp4&#34;) # 图像的读取 # 异常处理 if vc.isOpened(): oepn,frame = vc.read() else: open = False # 使用循环体对每一帧图像进行读取 while open: ret,frame=vc.read() # frame位置是帧，如果视频没有了，frame变为None,视频退出播放 if frame is None: break # ret 表示程序能否读取视频 if ret == True: cv2.imshow(&#34;这是一个测试&#34;,cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY))# 对每一帧进行灰度处理 if cv2.waitKey(10)&amp;0xFF==27: # 程序等待10毫秒，在这个时间内检测用户键盘输入，esc的ASCII码是27.检测后进入下一次的while循环 break vc.release() cv2.destroyAllWindows() 图像的灰度处理、截取、颜色通道的提取、调整大小与融合、阈值 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 import cv2 import numpy as np def cv_show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 图像的灰度处理方法一：在imread中添加相关参数，这钟方法不建议使用，此处不再写 # 图像的灰度处理方法二：将传入的图像进行二次处理,这种方法可以分别得到原图和灰度图，方便展示 image = cv2.imread(r&#34;./pictures/GEM.png&#34;) image_gray = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY) &#34;&#34;&#34; 截取图像，在使用imread后，得到的是一个矩阵（或者说是一个list[]列表），可以使用切片的方法从里面得到部分数据 对于BGR彩色图，这个list是一个&#34;[[[B,G,R]]]&#34;,比如下面这个3*3的图片 [[[ 62 62 62] [ 56 56 56] [ 33 33 33]] [[126 126 126] [ 58 58 58] [ 57 57 57]] [[ 61 61 61] [ 94 94 94] [217 217 217]]] 可以横向进行表示，更容易理解： [[[ 62 62 62],[ 56 56 56],[ 33 33 33]] [[126 126 126],[ 58 58 58],[ 57 57 57]] [[ 61 61 61],[ 94 94 94],[217 217 217]]] list[0:2]可以把0行、1行拿出来，也就是列表中的第一行和第二行 list[0:2][0:1]可以把列表中前两行、第一列列拿出来。当然了list[0:2,0:1]和list[0:2][0:1]是一样的。 进一步的说[0:2]是图片的高，[0:1]是图片的宽。在cv2中图像的坐标原点在左上角，水平方向是w轴，竖直方向是h，要理解图像和矩阵之间的转换关系。 每一个像素点由三个数字表示；对于灰度图，一个数字就可以表示一个像素点。 &#34;&#34;&#34; # 在理解了图像和矩阵或者说列表之间的关系，下面的就很好理解了。对列表进行三次切片可以得到相应的BGR颜色值。 #只保留R.注意在cv2中顺序是BGR，不是RGB image[:,:,0]=0 image[:,:,1]=0 &#34;&#34;&#34; cv2.resize(image1,(100,100)) #调整大小为100*100 cv2.resize(image1,(0,0),fx=2,fy=2) #图像沿着x方向y方向进行拉伸 cv2.addWeighted(image,0.5,image1,0.5,0) #res=A*image+B*image1+C,在这里A,B,C分别是0.5，0.5，0 &#34;&#34;&#34; 边界填充 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(image): cv2.imshow(&#34;this is a top&#34;,image) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(r&#34;./pictures/03.png&#34;)# 图片大小(746, 1374, 3) # 为了进行边界填充，首先将图片进行切割。 image2 = image1[0:512,0:512] # 边界填充 top,bottom,left,right =(100,100,100,100) # 1.replicate法填充 replicate = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REPLICATE) # 2.reflect 法填充 reflect = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REFLECT) # 3.reflect101 法填充 reflect101 = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REFLECT_101) # 4.wrap法填充 wrap = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_WRAP) # 5.constant法填充 constant = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_CONSTANT,value=0) #图片展示，其中&#34;231&#34;，2表示总行数；3表示总列数；1表示这六个位置中的第一个位置。 plt.figure(figsize=(10, 6)) plt.subplot(231),plt.imshow(replicate),plt.title(&#39;replicate法填充&#39;) plt.subplot(232),plt.imshow(reflect),plt.title(&#39;reflect法填充&#39;) plt.subplot(233),plt.imshow(reflect101),plt.title(&#39;reflect101法填充&#39;) plt.subplot(234),plt.imshow(wrap),plt.title(&#39;wrap法填充&#39;) plt.subplot(235),plt.imshow(constant),plt.title(&#39;constant法填充&#39;) plt.show(plt) 数值计算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import numpy as np import cv2 import matplotlib.pyplot as plt def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(r&#34;./pictures/opencv_logo.jpg&#34;) image2 = cv2.imread(r&#34;./pictures/plane.jpg&#34;) image = image2[0:250,0:250] # 使image与image1大小相同，以保证矩阵能正常进行运算 def fun1(): image = image2[0:250,0:250] cv2.imshow(&#34;6&#34;,image+100) # 将矩阵中的每一个数字加100 cv2.imshow(&#34;6&#34;,image+image1) # 大小相同的两个矩阵相加，超过255的部分取余数 cv2.add(image1,image) #大小相同的两个矩阵相加，超过255的统一取为255 cv2.waitKey(0) cv2.destroyAllWindows() 图像平滑处理（滤波处理） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/bad.png&#34;,cv2.IMREAD_GRAYSCALE) # 均值滤波 cvshow1 = cv2.blur(image1,(3,3)) # 方框滤波 cvshow2=cv2.boxFilter(image1,-1,(3,3),normalize=True)# 效果同上均值滤波 cvshow3=cv2.boxFilter(image1,-1,(3,3),normalize=False)# 越界了 # 高斯滤波 cvshow4=cv2.GaussianBlur(image1,(3,3),1) # 中值滤波 cvshow5=cv2.medianBlur(image1,5) plt.figure(figsize=(15, 6)) plt.subplot(231),plt.imshow(cvshow1, cmap=&#39;gray&#39;),plt.title(&#39;均值滤波&#39;) plt.subplot(232),plt.imshow(cvshow2, cmap=&#39;gray&#39;),plt.title(&#39;方框滤波_normalize=True&#39;) plt.subplot(233),plt.imshow(cvshow3, cmap=&#39;gray&#39;),plt.title(&#39;方框滤波_normalize=False&#39;) plt.subplot(234),plt.imshow(cvshow4, cmap=&#39;gray&#39;),plt.title(&#39;高斯滤波&#39;) plt.subplot(235),plt.imshow(cvshow5, cmap=&#39;gray&#39;),plt.title(&#39;中值滤波&#39;) plt.show(plt) 腐蚀与膨胀及其组合（开运算、闭运算、梯度运算、礼帽与黑帽） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() &#34;&#34;&#34; 腐蚀与膨胀操作用于处理二值化的图像，由于大多数图片都是BGR三色的 下面写一个函数，将BGR图片处理为二值化图片 &#34;&#34;&#34; def img_twonum(image1): image = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY)#确保图像是灰度图 ret,dst=cv2.threshold(image,127,255,cv2.THRESH_BINARY) return dst image1 = cv2.imread(r&#34;./pictures/fushi.png&#34;) image2 = img_twonum(image1) kernel = np.ones((5,5),np.uint8) #用 NumPy 库创建一个 5x5 的全1矩阵（内核/结构元素），数据类型为无符号8位整数（取值范围 0-255） erosion = cv2.erode(image2,kernel,iterations=1) # 腐蚀 # 最后的参数表示迭代次数 dilt = cv2.dilate(image2,kernel,iterations=1) # 膨胀 opening = cv2.morphologyEx(image2,cv2.MORPH_OPEN,kernel) # 开运算:先腐蚀再膨胀 close = cv2.morphologyEx(image2,cv2.MORPH_CLOSE,kernel) # 闭运算:先膨胀再腐蚀 gradient = cv2.morphologyEx(image2,cv2.MORPH_GRADIENT,kernel) # 梯度运算= 膨胀-腐蚀。得到边缘信息 tophat = cv2.morphologyEx(image2,cv2.MORPH_TOPHAT,kernel) # 礼帽= 原始输入-开运算 得到的是刺 blackhat = cv2.morphologyEx(image2,cv2.MORPH_BLACKHAT,kernel) # 黑帽 = 闭运算-原始输入 得到的是主体大概的轮廓 plt.figure(figsize=(15, 6)) plt.subplot(241),plt.imshow(erosion, cmap=&#39;gray&#39;),plt.title(&#39;腐蚀&#39;) plt.subplot(242),plt.imshow(dilt, cmap=&#39;gray&#39;),plt.title(&#39;膨胀&#39;) plt.subplot(243),plt.imshow(opening, cmap=&#39;gray&#39;),plt.title(&#39;开运算:先腐蚀再膨胀&#39;) plt.subplot(244),plt.imshow(close, cmap=&#39;gray&#39;),plt.title(&#39;闭运算:先膨胀再腐蚀&#39;) plt.subplot(245),plt.imshow(gradient, cmap=&#39;gray&#39;),plt.title(&#39;梯度运算= 膨胀-腐蚀&#39;) plt.subplot(246),plt.imshow(tophat, cmap=&#39;gray&#39;),plt.title(&#39;礼帽=原始输入-开运算&#39;) plt.subplot(247),plt.imshow(blackhat, cmap=&#39;gray&#39;),plt.title(&#39;黑帽=闭运算-原始输入&#39;) plt.show(plt) 图像梯度计算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False &#34;&#34;&#34; 求梯度多用于灰度图片 但是不建议把dx,dx同时设置为1别计算，应该把dx、dy分开求出来，再进行融合 &#34;&#34;&#34; def cvshow(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() def juedui(*args): # 用于矩阵求绝对值 img = cv2.convertScaleAbs(*args) return img image1 = cv2.imread(&#34;./pictures/pie.png&#34;,cv2.IMREAD_GRAYSCALE) # sobel算子,分别计算x和y方向的一阶梯度，合并后显示边缘 sobelx = cv2.Sobel(image1,cv2.CV_64F,1,0,ksize=3) sobely = cv2.Sobel(image1,cv2.CV_64F,0,1,ksize=3) # scharr算子,类似Sobel，但对边缘更敏感 scharrx = cv2.Scharr(image1,cv2.CV_64F,1,0) scharry = cv2.Scharr(image1,cv2.CV_64F,0,1) # Laplacian算子,显示二阶导数边缘，通常比一阶算子对噪声更敏感，边缘更细,不能分开求 laplacian = cv2.Laplacian(image1,cv2.CV_64F,ksize=3) # 分别对每个梯度图像求绝对值 sobelx = cv2.convertScaleAbs(sobelx) sobely = cv2.convertScaleAbs(sobely) scharrx = cv2.convertScaleAbs(scharrx) scharry = cv2.convertScaleAbs(scharry) laplacian = cv2.convertScaleAbs(laplacian) # 求两个方向的梯度 sobelxy = cv2.addWeighted(sobelx,0.5,sobely,0.5,0) scharrxy = cv2.addWeighted(scharrx,0.5,scharry,0.5,0) plt.figure(figsize=(15, 2)) plt.subplot(131),plt.imshow(sobelxy, cmap=&#39;gray&#39;),plt.title(&#39;sobel算子&#39;) plt.subplot(132),plt.imshow(scharrxy, cmap=&#39;gray&#39;),plt.title(&#39;scharr算子,类似Sobel，但对边缘更敏感&#39;) plt.subplot(133),plt.imshow(laplacian, cmap=&#39;gray&#39;),plt.title(&#39;Laplacian算子,显示二阶导数边缘&#39;) plt.show() canny边缘检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import numpy as np import cv2 import matplotlib.pyplot as plt image1 = cv2.imread(&#34;./pictures/bad.png&#34;,cv2.IMREAD_GRAYSCALE) v1= cv2.Canny(image1,10,150) # 分别指的是maxval,minval v2= cv2.Canny(image1,30,150) v3= cv2.Canny(image1,50,150) v4= cv2.Canny(image1,50,51) v5= cv2.Canny(image1,50,100) v6= cv2.Canny(image1,50,200) v7= cv2.Canny(image1,145,150) v8= cv2.Canny(image1,200,201) plt.figure(figsize=(15, 6)) plt.subplot(241),plt.imshow(v1, cmap=&#39;gray&#39;),plt.title(&#39;canny_10*150&#39;) plt.subplot(242),plt.imshow(v2, cmap=&#39;gray&#39;),plt.title(&#39;canny_30*150&#39;) plt.subplot(243),plt.imshow(v3, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*150&#39;) plt.subplot(244),plt.imshow(v4, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*51&#39;) plt.subplot(245),plt.imshow(v5, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*100&#39;) plt.subplot(246),plt.imshow(v6, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*200&#39;) plt.subplot(247),plt.imshow(v7, cmap=&#39;gray&#39;),plt.title(&#39;canny_145*150&#39;) plt.subplot(248),plt.imshow(v8, cmap=&#39;gray&#39;),plt.title(&#39;canny_200*201&#39;) plt.show() 图像金字塔 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 高斯金字塔 image1 = cv2.imread(r&#34;./pictures/AM.png&#34;,cv2.IMREAD_GRAYSCALE) up1 =cv2.pyrUp(image1) #图像变大 up2 =cv2.pyrDown(image1) #图像变大小 # 拉普拉斯金字塔 def laplasi(): image1 = cv2.imread(r&#34;./pictures/AM.png&#34;, cv2.IMREAD_GRAYSCALE) down = cv2.pyrDown(image1) down_up = cv2.pyrUp(down) image = image1-down_up # 这个拉普拉斯金字塔只迭代了1次 image1 = cv2.imread(r&#34;./pictures/AM.png&#34;, cv2.IMREAD_GRAYSCALE) for i in range(0,1): # 这里可以设置迭代次数 down = cv2.pyrDown(image1) down_up = cv2.pyrUp(down) image1 = image1-down_up plt.subplot(131),plt.imshow(up1,cmap=&#39;gray&#39;),plt.title(&#39;高斯金字塔_up&#39;) plt.subplot(132),plt.imshow(up2,cmap=&#39;gray&#39;),plt.title(&#39;高斯金字塔_down&#39;) plt.subplot(133),plt.imshow(image1,cmap=&#39;gray&#39;),plt.title(&#39;拉普拉斯金字塔&#39;) plt.show() 图像轮廓 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/cars.jpg&#34;) gray = cv2.cvtColor(image1,cv2.COLOR_BGR2GRAY) a,image1_1 = cv2.threshold(gray,127,255,cv2.THRESH_BINARY) binary,contours,hierarchy = cv2.findContours(image1_1,cv2.RETR_TREE,cv2.CHAIN_APPROX_NONE) # 绘制轮廓 drawimage = image1.copy() # ###注意不要对原图进行操作 res = cv2.drawContours(drawimage,contours,-1,(0,0,255),2) res_rgb = cv2.cvtColor(res, cv2.COLOR_BGR2RGB) # 关键步骤：BGR转RGB plt.subplot(),plt.imshow(res_rgb),plt.title(&#39;绘制轮廓&#39;) plt.show() # 进一步可以调用轮廓的各种特征 轮廓近似 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import numpy as np import cv2 from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() import cv2 from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/lunkuo.png&#34;) # 图像预处理 gray1 = cv2.cvtColor(image1,cv2.COLOR_BGR2GRAY) a,image2 = cv2.threshold(gray1,127,255,cv2.THRESH_BINARY) binary,contours,hierarchy = cv2.findContours(image2,cv2.RETR_TREE,cv2.CHAIN_APPROX_NONE) cont = contours[0] #检测到的第一个轮廓 epsilon = 0.1*cv2.arcLength(cont,True) approx = cv2.approxPolyDP(cont,epsilon,True) image3 = image1.copy() res = cv2.drawContours(image3,[approx],-1,(0,0,255),2) # 外接矩形 x,y,w,h = cv2.boundingRect(cont) image4 = image1.copy() image4 = cv2.rectangle(image4,(x,y),(x+w,y+h),(0,0,255),2) # 外接圆 (x,y),radius = cv2.minEnclosingCircle(cont) center = (int(x),int(y)) radius= int(radius) image5 = cv2.circle(image1,center,radius,(0,0,255),2) image = hstack((res,image4,image5)) cvshow(image) 图像匹配 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 import numpy as np import cv2 from cv2 import TM_CCORR, TM_CCORR_NORMED, TM_SQDIFF, TM_SQDIFF_NORMED from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/GEM.png&#34;,0) image2=cv2.imread(r&#34;./pictures/GEM_face.png&#34;,0) image3 = image1.copy() h,w = image2.shape[:2] &#34;&#34;&#34; cv2.IMREAD_COLOR (1)：加载彩色图像，忽略透明度。 cv2.IMREAD_GRAYSCALE (0)：以灰度模式加载图像。 cv2.IMREAD_UNCHANGED (-1)：加载图像包含alpha通道。 &#34;&#34;&#34; res = cv2.matchTemplate(image1,image2,TM_CCORR_NORMED) a,b,c,d = cv2.minMaxLoc(res) youxia = (d[0]+w,d[1]+h) image = cv2.rectangle(image3,d,youxia,(0,255,0),2) cvshow(image) 直方图 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 %matplotlib inline import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image1 = cv2.imread(&#34;./pictures/GEM.png&#34;) image1_gray = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY) # 计算灰度直方图（OpenCV方式） hist = cv2.calcHist([image1_gray], [0], None, [256], [0, 256]) # 将直方图数据转换为可绘制的形式 plt.figure(figsize=(10, 2)) plt.plot(hist, color=&#39;blue&#39;) # 用曲线绘制直方图 # 或使用柱状图： # plt.bar(range(256), hist.ravel(), color=&#39;gray&#39;, width=1.0) # 设置图表属性 plt.title(&#34;灰度直方图（基于cv2.calcHist）&#34;),plt.xlabel(&#34;像素值 (0-255)&#34;),plt.ylabel(&#34;频次&#34;),plt.xlim([0, 255]) # 限制X轴范围 plt.grid(alpha=1) # 表示网格线是半透明的（30% 不透明） plt.show() # 分别统计这张彩色图的b、g、r plt.figure(figsize=(10, 2)) color = (&#39;b&#39;,&#39;g&#39;,&#39;r&#39;) # 通过for循环，将不同颜色进行统计，绘制在三张图上，最后将三张图统一展示。 for i, col in enumerate(color): # enumerate可以同时得到索引和数据 hist = cv2.calcHist([image1], [i], None, [256], [0, 256]) plt.plot(hist, color=col) plt.xlim([0, 256]) plt.show() musk的使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 %matplotlib inline import numpy as np import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image= cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE) musk = np.zeros(image.shape[:2],np.uint8) musk[100:300,100:400] = 255 # 把保存的东西设置为255 hist = cv2.calcHist([image],[0],musk,[256],[0,256]) plt.figure(figsize=(10, 2)) plt.plot(hist) plt.xlim([0,256]) plt.show() 均衡化与自适应均衡化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import numpy as np import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image= cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE) musk = np.zeros(image.shape[:2],np.uint8) musk[100:300,100:400] = 255 hist = cv2.calcHist([image],[0],musk,[256],[0,256]) a = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8,8)) res_clahe = a.apply(image) equ = cv2.equalizeHist(image) plt.figure(figsize=(8, 2)) plt.subplot(122),plt.imshow(res_clahe,cmap=&#39;gray&#39;),plt.title(&#34;自适应均衡化&#34;) plt.subplot(121),plt.imshow(equ,cmap=&#39;gray&#39;),plt.title(&#34;均衡化&#34;) plt.show() 低通与高通滤波 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import cv2 import numpy as np import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image = cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE)#读取图像 image_float32 = np.float32(image) # 转化格式为np.float32 a = cv2.dft(image_float32, flags=cv2.DFT_COMPLEX_OUTPUT) # 进行频域变化 a_shift = np.fft.fftshift(a) # 将低频值放到中心处 img2 = 20*np.log(cv2.magnitude(a_shift[:,:,0], a_shift[:,:,1])) # 转化为灰度图可以展示的图像 rows, cols = image.shape crow, ccol = int(rows / 2), int(cols / 2) # 低通滤波器(会使得图像变模糊) musk = np.zeros((rows, cols,2),np.uint8) musk[crow-30:crow+30, ccol-30:ccol+30] = 1 # IDFT fshift = a_shift*musk f_shift = np.fft.ifftshift(fshift) # 还原这一步操作：“将低频值放到中心处” img = cv2.idft(f_shift) img = cv2.magnitude(img[:,:,0], img[:,:,1]) # 把实部与虚部分开 # 高通滤波器 musk2 = np.ones((rows, cols,2),np.uint8) musk2[crow-30:crow+30, ccol-30:ccol+30] = 0 fshift2 = a_shift*musk2 f_shift2 = np.fft.ifftshift(fshift2) img2 = cv2.idft(f_shift2) img2 = cv2.magnitude(img2[:,:,0], img2[:,:,1]) plt.subplot(221),plt.imshow(img2, cmap=&#39;gray&#39;),plt.title(&#34;频域图&#34;) plt.subplot(222),plt.imshow(image, cmap=&#39;gray&#39;),plt.title(&#34;原始图像&#34;) plt.subplot(223),plt.imshow(img, cmap=&#39;gray&#39;),plt.title(&#34;低通滤波器&#34;) plt.subplot(224),plt.imshow(img2, cmap=&#39;gray&#39;),plt.title(&#34;高通滤波器&#34;) plt.show() 角点检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image = cv2.imread(&#34;./pictures/guojixiangqi_qipan.jpg&#34;) image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) image_gray_32 = np.float32(image_gray) # ！！！注意要求把灰度图转化为np.float32格式的，这很重要！！！ dst = cv2.cornerHarris(image_gray_32, 2, 3, 0.04) # 固定用法 image[dst &gt; 0.01 * dst.max()] = [0, 0, 255] # 固定用法，用于筛选出响应值大于最大响应值 1% 的像素点，这些像素点被认为是角点 plt.imshow(image),plt.title(&#34;角点检测&#34;) plt.show() .SIFT函数检测特征点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 图像读取与预处理 image = cv2.imread(&#34;./pictures/GEM.png&#34;) image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) # 得到特征点（key points） sift = cv2.xfeatures2d.SIFT_create() kp = sift.detect(image_gray, None) # 传入的是灰度图 # 绘制特征点 image = cv2.drawKeypoints(image_gray, kp, image, color=(0, 255, 0)) # 输出图片 plt.subplot(),plt.imshow(image, cmap=&#39;gray&#39;),plt.title(&#34;SIFT特征点&#34;),plt.show() # 计算特征 kp,des = sift.compute(image_gray, kp) print(np.array(kp).shape) # 特征点的个数 print(des.shape) # 每一个特征点都是一个128维的向量 print(des[0]) # 每一个特征点都是一个128维的向量，可以数一下是128维 Brute-Force蛮力匹配 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 %matplotlib inline import numpy as np import matplotlib.pyplot as plt import cv2 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/GEM_face.png&#34;) image2 = cv2.imread(&#34;./pictures/GEM.png&#34;) sift = cv2.xfeatures2d.SIFT_create() kp1, des1 = sift.detectAndCompute(image1, None) # 找到特征点与特征向量 kp2, des2 = sift.detectAndCompute(image2, None) # 找到特征点与特征向量 bf1 = cv2.BFMatcher(crossCheck=True) # 1对1的匹配 matches = bf1.match(des1, des2) matches = sorted(matches, key=lambda x: x.distance) image3 = cv2.drawMatches(image1, kp1, image2, kp2, matches[:10], None, flags=2) # k对最佳匹配 bf2 = cv2.BFMatcher() matches2 = bf2.knnMatch(des1,des2,2) good = [] for m, n in matches2: if m.distance &lt; 0.75*n.distance: good.append(m) image4 = cv2.drawMatches(image1, kp1, image2, kp2, good, None, flags=2) # 展示图片 image3_rgb = image3[:, :, ::-1] # 把BGR图片转化为RGB图片 image4_rgb = image4[:, :, ::-1] # 把BGR图片转化为RGB图片 plt.subplot(221),plt.imshow(image3_rgb),plt.title(&#34;1对1的匹配&#34;) plt.subplot(222),plt.imshow(image4_rgb),plt.title(&#34;k对最佳匹配&#34;) plt.show() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False imageA = cv2.imread(&#34;./pictures/p1.png&#34;) imageB = cv2.imread(&#34;./pictures/p2.png&#34;) gray1 = cv2.cvtColor(imageA, cv2.COLOR_BGR2GRAY) gray2 = cv2.cvtColor(imageB, cv2.COLOR_BGR2GRAY) sift = cv2.xfeatures2d.SIFT_create() kpsA,dpA = sift.detectAndCompute(gray1, None) kpsB,dpB = sift.detectAndCompute(gray2, None) bf = cv2.BFMatcher() matches = bf.knnMatch(dpA,dpB,2) good = [] for m in matches: if len(m) == 2 and m[0].distance &lt; m[1].distance * 0.75: good.append((m[0].queryIdx,m[0].trainIdx)) kps1 = np.float32([kp.pt for kp in kpsA]) kps2 = np.float32([kp.pt for kp in kpsB]) kps1 = np.float32([kps1[a[0]] for a in good]) kps2 = np.float32([kps2[a[1]] for a in good]) M,status = cv2.findHomography(kps2,kps1,cv2.RANSAC,4.0) result = cv2.warpPerspective(imageB, M, (imageA.shape[1]+imageB.shape[1],imageA.shape[0])) result[0:imageA.shape[0],0:imageA.shape[1]] = imageA # 计算变换后的图像B的边界 h, w = imageB.shape[:2] corners = np.array([[0, 0], [0, h-1], [w-1, h-1], [w-1, 0]], dtype=np.float32) warped_corners = cv2.perspectiveTransform(corners.reshape(1, -1, 2), M).reshape(-1, 2) # 计算输出画布的最小包围矩形 all_corners = np.concatenate((warped_corners, np.array([[0,0], [imageA.shape[1], imageA.shape[0]]])), axis=0) x_min, y_min = np.floor(np.min(all_corners, axis=0)).astype(int) x_max, y_max = np.ceil(np.max(all_corners, axis=0)).astype(int) # 计算平移变换矩阵 offset_x = -x_min offset_y = -y_min translation_matrix = np.array([[1, 0, offset_x], [0, 1, offset_y], [0, 0, 1]]) # 调整单应性矩阵并执行透视变换 adjusted_homography = translation_matrix.dot(M) result = cv2.warpPerspective(imageB, adjusted_homography, (x_max - x_min, y_max - y_min)) # 创建新的拼接画布 result[offset_y:offset_y+imageA.shape[0], offset_x:offset_x+imageA.shape[1]] = imageA # 自动裁剪黑边 gray = cv2.cvtColor(result, cv2.COLOR_BGR2GRAY) _, thresh = cv2.threshold(gray, 1, 255, cv2.THRESH_BINARY) _,contours, _ = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE) x,y,w,h = cv2.boundingRect(contours[0]) final = result[y:y+h, x:x+w] # 展示图片 final_rgb = final[:, :, ::-1] # 把BGR图片转化为RGB图片 imageA_rgb = imageA[:, :, ::-1]# 把BGR图片转化为RGB图片 imageB_rgb = imageB[:, :, ::-1]# 把BGR图片转化为RGB图片 plt.subplot(131),plt.imshow(imageA_rgb),plt.title(&#34;左边的图片&#34;) plt.subplot(132),plt.imshow(imageB_rgb),plt.title(&#34;右边的图片&#34;) plt.subplot(133),plt.imshow(final_rgb),plt.title(&#34;拼接后的图片&#34;) plt.show() ">
<meta property='og:url' content='http://localhost:5377/p/opencv%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/'>
<meta property='og:site_name' content='胥振泉'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='opencv' /><meta property='article:tag' content='机器学习' /><meta property='article:published_time' content='2025-04-13T14:47:46&#43;08:00'/><meta property='article:modified_time' content='2025-04-13T14:47:46&#43;08:00'/>
<meta name="twitter:title" content="opencv学习笔记">
<meta name="twitter:description" content="图像读取 1 2 3 4 5 6 7 8 9 10 11 12 # 导包 import cv2 import numpy as np from numpy.ma import hstack# 用于横向拼接图片 from numpy.ma import vstack# 用于纵向拼接图片 def cv_show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/plane.jpg&#34;) image2 = cv2.imread(&#34;./pictures/plane.jpg&#34;,cv2.IMREAD_GRAYSCALE) cv_show(image2) 视频读取 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import cv2 import numpy as np vc = cv2.VideoCapture(r&#34;C:\\Users\\zhenq\\Videos\\03.mp4&#34;) # 图像的读取 # 异常处理 if vc.isOpened(): oepn,frame = vc.read() else: open = False # 使用循环体对每一帧图像进行读取 while open: ret,frame=vc.read() # frame位置是帧，如果视频没有了，frame变为None,视频退出播放 if frame is None: break # ret 表示程序能否读取视频 if ret == True: cv2.imshow(&#34;这是一个测试&#34;,cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY))# 对每一帧进行灰度处理 if cv2.waitKey(10)&amp;0xFF==27: # 程序等待10毫秒，在这个时间内检测用户键盘输入，esc的ASCII码是27.检测后进入下一次的while循环 break vc.release() cv2.destroyAllWindows() 图像的灰度处理、截取、颜色通道的提取、调整大小与融合、阈值 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 import cv2 import numpy as np def cv_show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 图像的灰度处理方法一：在imread中添加相关参数，这钟方法不建议使用，此处不再写 # 图像的灰度处理方法二：将传入的图像进行二次处理,这种方法可以分别得到原图和灰度图，方便展示 image = cv2.imread(r&#34;./pictures/GEM.png&#34;) image_gray = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY) &#34;&#34;&#34; 截取图像，在使用imread后，得到的是一个矩阵（或者说是一个list[]列表），可以使用切片的方法从里面得到部分数据 对于BGR彩色图，这个list是一个&#34;[[[B,G,R]]]&#34;,比如下面这个3*3的图片 [[[ 62 62 62] [ 56 56 56] [ 33 33 33]] [[126 126 126] [ 58 58 58] [ 57 57 57]] [[ 61 61 61] [ 94 94 94] [217 217 217]]] 可以横向进行表示，更容易理解： [[[ 62 62 62],[ 56 56 56],[ 33 33 33]] [[126 126 126],[ 58 58 58],[ 57 57 57]] [[ 61 61 61],[ 94 94 94],[217 217 217]]] list[0:2]可以把0行、1行拿出来，也就是列表中的第一行和第二行 list[0:2][0:1]可以把列表中前两行、第一列列拿出来。当然了list[0:2,0:1]和list[0:2][0:1]是一样的。 进一步的说[0:2]是图片的高，[0:1]是图片的宽。在cv2中图像的坐标原点在左上角，水平方向是w轴，竖直方向是h，要理解图像和矩阵之间的转换关系。 每一个像素点由三个数字表示；对于灰度图，一个数字就可以表示一个像素点。 &#34;&#34;&#34; # 在理解了图像和矩阵或者说列表之间的关系，下面的就很好理解了。对列表进行三次切片可以得到相应的BGR颜色值。 #只保留R.注意在cv2中顺序是BGR，不是RGB image[:,:,0]=0 image[:,:,1]=0 &#34;&#34;&#34; cv2.resize(image1,(100,100)) #调整大小为100*100 cv2.resize(image1,(0,0),fx=2,fy=2) #图像沿着x方向y方向进行拉伸 cv2.addWeighted(image,0.5,image1,0.5,0) #res=A*image+B*image1+C,在这里A,B,C分别是0.5，0.5，0 &#34;&#34;&#34; 边界填充 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(image): cv2.imshow(&#34;this is a top&#34;,image) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(r&#34;./pictures/03.png&#34;)# 图片大小(746, 1374, 3) # 为了进行边界填充，首先将图片进行切割。 image2 = image1[0:512,0:512] # 边界填充 top,bottom,left,right =(100,100,100,100) # 1.replicate法填充 replicate = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REPLICATE) # 2.reflect 法填充 reflect = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REFLECT) # 3.reflect101 法填充 reflect101 = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_REFLECT_101) # 4.wrap法填充 wrap = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_WRAP) # 5.constant法填充 constant = cv2.copyMakeBorder(image2,top,bottom,left,right,borderType=cv2.BORDER_CONSTANT,value=0) #图片展示，其中&#34;231&#34;，2表示总行数；3表示总列数；1表示这六个位置中的第一个位置。 plt.figure(figsize=(10, 6)) plt.subplot(231),plt.imshow(replicate),plt.title(&#39;replicate法填充&#39;) plt.subplot(232),plt.imshow(reflect),plt.title(&#39;reflect法填充&#39;) plt.subplot(233),plt.imshow(reflect101),plt.title(&#39;reflect101法填充&#39;) plt.subplot(234),plt.imshow(wrap),plt.title(&#39;wrap法填充&#39;) plt.subplot(235),plt.imshow(constant),plt.title(&#39;constant法填充&#39;) plt.show(plt) 数值计算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import numpy as np import cv2 import matplotlib.pyplot as plt def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(r&#34;./pictures/opencv_logo.jpg&#34;) image2 = cv2.imread(r&#34;./pictures/plane.jpg&#34;) image = image2[0:250,0:250] # 使image与image1大小相同，以保证矩阵能正常进行运算 def fun1(): image = image2[0:250,0:250] cv2.imshow(&#34;6&#34;,image+100) # 将矩阵中的每一个数字加100 cv2.imshow(&#34;6&#34;,image+image1) # 大小相同的两个矩阵相加，超过255的部分取余数 cv2.add(image1,image) #大小相同的两个矩阵相加，超过255的统一取为255 cv2.waitKey(0) cv2.destroyAllWindows() 图像平滑处理（滤波处理） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/bad.png&#34;,cv2.IMREAD_GRAYSCALE) # 均值滤波 cvshow1 = cv2.blur(image1,(3,3)) # 方框滤波 cvshow2=cv2.boxFilter(image1,-1,(3,3),normalize=True)# 效果同上均值滤波 cvshow3=cv2.boxFilter(image1,-1,(3,3),normalize=False)# 越界了 # 高斯滤波 cvshow4=cv2.GaussianBlur(image1,(3,3),1) # 中值滤波 cvshow5=cv2.medianBlur(image1,5) plt.figure(figsize=(15, 6)) plt.subplot(231),plt.imshow(cvshow1, cmap=&#39;gray&#39;),plt.title(&#39;均值滤波&#39;) plt.subplot(232),plt.imshow(cvshow2, cmap=&#39;gray&#39;),plt.title(&#39;方框滤波_normalize=True&#39;) plt.subplot(233),plt.imshow(cvshow3, cmap=&#39;gray&#39;),plt.title(&#39;方框滤波_normalize=False&#39;) plt.subplot(234),plt.imshow(cvshow4, cmap=&#39;gray&#39;),plt.title(&#39;高斯滤波&#39;) plt.subplot(235),plt.imshow(cvshow5, cmap=&#39;gray&#39;),plt.title(&#39;中值滤波&#39;) plt.show(plt) 腐蚀与膨胀及其组合（开运算、闭运算、梯度运算、礼帽与黑帽） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() &#34;&#34;&#34; 腐蚀与膨胀操作用于处理二值化的图像，由于大多数图片都是BGR三色的 下面写一个函数，将BGR图片处理为二值化图片 &#34;&#34;&#34; def img_twonum(image1): image = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY)#确保图像是灰度图 ret,dst=cv2.threshold(image,127,255,cv2.THRESH_BINARY) return dst image1 = cv2.imread(r&#34;./pictures/fushi.png&#34;) image2 = img_twonum(image1) kernel = np.ones((5,5),np.uint8) #用 NumPy 库创建一个 5x5 的全1矩阵（内核/结构元素），数据类型为无符号8位整数（取值范围 0-255） erosion = cv2.erode(image2,kernel,iterations=1) # 腐蚀 # 最后的参数表示迭代次数 dilt = cv2.dilate(image2,kernel,iterations=1) # 膨胀 opening = cv2.morphologyEx(image2,cv2.MORPH_OPEN,kernel) # 开运算:先腐蚀再膨胀 close = cv2.morphologyEx(image2,cv2.MORPH_CLOSE,kernel) # 闭运算:先膨胀再腐蚀 gradient = cv2.morphologyEx(image2,cv2.MORPH_GRADIENT,kernel) # 梯度运算= 膨胀-腐蚀。得到边缘信息 tophat = cv2.morphologyEx(image2,cv2.MORPH_TOPHAT,kernel) # 礼帽= 原始输入-开运算 得到的是刺 blackhat = cv2.morphologyEx(image2,cv2.MORPH_BLACKHAT,kernel) # 黑帽 = 闭运算-原始输入 得到的是主体大概的轮廓 plt.figure(figsize=(15, 6)) plt.subplot(241),plt.imshow(erosion, cmap=&#39;gray&#39;),plt.title(&#39;腐蚀&#39;) plt.subplot(242),plt.imshow(dilt, cmap=&#39;gray&#39;),plt.title(&#39;膨胀&#39;) plt.subplot(243),plt.imshow(opening, cmap=&#39;gray&#39;),plt.title(&#39;开运算:先腐蚀再膨胀&#39;) plt.subplot(244),plt.imshow(close, cmap=&#39;gray&#39;),plt.title(&#39;闭运算:先膨胀再腐蚀&#39;) plt.subplot(245),plt.imshow(gradient, cmap=&#39;gray&#39;),plt.title(&#39;梯度运算= 膨胀-腐蚀&#39;) plt.subplot(246),plt.imshow(tophat, cmap=&#39;gray&#39;),plt.title(&#39;礼帽=原始输入-开运算&#39;) plt.subplot(247),plt.imshow(blackhat, cmap=&#39;gray&#39;),plt.title(&#39;黑帽=闭运算-原始输入&#39;) plt.show(plt) 图像梯度计算 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False &#34;&#34;&#34; 求梯度多用于灰度图片 但是不建议把dx,dx同时设置为1别计算，应该把dx、dy分开求出来，再进行融合 &#34;&#34;&#34; def cvshow(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() def juedui(*args): # 用于矩阵求绝对值 img = cv2.convertScaleAbs(*args) return img image1 = cv2.imread(&#34;./pictures/pie.png&#34;,cv2.IMREAD_GRAYSCALE) # sobel算子,分别计算x和y方向的一阶梯度，合并后显示边缘 sobelx = cv2.Sobel(image1,cv2.CV_64F,1,0,ksize=3) sobely = cv2.Sobel(image1,cv2.CV_64F,0,1,ksize=3) # scharr算子,类似Sobel，但对边缘更敏感 scharrx = cv2.Scharr(image1,cv2.CV_64F,1,0) scharry = cv2.Scharr(image1,cv2.CV_64F,0,1) # Laplacian算子,显示二阶导数边缘，通常比一阶算子对噪声更敏感，边缘更细,不能分开求 laplacian = cv2.Laplacian(image1,cv2.CV_64F,ksize=3) # 分别对每个梯度图像求绝对值 sobelx = cv2.convertScaleAbs(sobelx) sobely = cv2.convertScaleAbs(sobely) scharrx = cv2.convertScaleAbs(scharrx) scharry = cv2.convertScaleAbs(scharry) laplacian = cv2.convertScaleAbs(laplacian) # 求两个方向的梯度 sobelxy = cv2.addWeighted(sobelx,0.5,sobely,0.5,0) scharrxy = cv2.addWeighted(scharrx,0.5,scharry,0.5,0) plt.figure(figsize=(15, 2)) plt.subplot(131),plt.imshow(sobelxy, cmap=&#39;gray&#39;),plt.title(&#39;sobel算子&#39;) plt.subplot(132),plt.imshow(scharrxy, cmap=&#39;gray&#39;),plt.title(&#39;scharr算子,类似Sobel，但对边缘更敏感&#39;) plt.subplot(133),plt.imshow(laplacian, cmap=&#39;gray&#39;),plt.title(&#39;Laplacian算子,显示二阶导数边缘&#39;) plt.show() canny边缘检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import numpy as np import cv2 import matplotlib.pyplot as plt image1 = cv2.imread(&#34;./pictures/bad.png&#34;,cv2.IMREAD_GRAYSCALE) v1= cv2.Canny(image1,10,150) # 分别指的是maxval,minval v2= cv2.Canny(image1,30,150) v3= cv2.Canny(image1,50,150) v4= cv2.Canny(image1,50,51) v5= cv2.Canny(image1,50,100) v6= cv2.Canny(image1,50,200) v7= cv2.Canny(image1,145,150) v8= cv2.Canny(image1,200,201) plt.figure(figsize=(15, 6)) plt.subplot(241),plt.imshow(v1, cmap=&#39;gray&#39;),plt.title(&#39;canny_10*150&#39;) plt.subplot(242),plt.imshow(v2, cmap=&#39;gray&#39;),plt.title(&#39;canny_30*150&#39;) plt.subplot(243),plt.imshow(v3, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*150&#39;) plt.subplot(244),plt.imshow(v4, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*51&#39;) plt.subplot(245),plt.imshow(v5, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*100&#39;) plt.subplot(246),plt.imshow(v6, cmap=&#39;gray&#39;),plt.title(&#39;canny_50*200&#39;) plt.subplot(247),plt.imshow(v7, cmap=&#39;gray&#39;),plt.title(&#39;canny_145*150&#39;) plt.subplot(248),plt.imshow(v8, cmap=&#39;gray&#39;),plt.title(&#39;canny_200*201&#39;) plt.show() 图像金字塔 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 高斯金字塔 image1 = cv2.imread(r&#34;./pictures/AM.png&#34;,cv2.IMREAD_GRAYSCALE) up1 =cv2.pyrUp(image1) #图像变大 up2 =cv2.pyrDown(image1) #图像变大小 # 拉普拉斯金字塔 def laplasi(): image1 = cv2.imread(r&#34;./pictures/AM.png&#34;, cv2.IMREAD_GRAYSCALE) down = cv2.pyrDown(image1) down_up = cv2.pyrUp(down) image = image1-down_up # 这个拉普拉斯金字塔只迭代了1次 image1 = cv2.imread(r&#34;./pictures/AM.png&#34;, cv2.IMREAD_GRAYSCALE) for i in range(0,1): # 这里可以设置迭代次数 down = cv2.pyrDown(image1) down_up = cv2.pyrUp(down) image1 = image1-down_up plt.subplot(131),plt.imshow(up1,cmap=&#39;gray&#39;),plt.title(&#39;高斯金字塔_up&#39;) plt.subplot(132),plt.imshow(up2,cmap=&#39;gray&#39;),plt.title(&#39;高斯金字塔_down&#39;) plt.subplot(133),plt.imshow(image1,cmap=&#39;gray&#39;),plt.title(&#39;拉普拉斯金字塔&#39;) plt.show() 图像轮廓 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import numpy as np import cv2 import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/cars.jpg&#34;) gray = cv2.cvtColor(image1,cv2.COLOR_BGR2GRAY) a,image1_1 = cv2.threshold(gray,127,255,cv2.THRESH_BINARY) binary,contours,hierarchy = cv2.findContours(image1_1,cv2.RETR_TREE,cv2.CHAIN_APPROX_NONE) # 绘制轮廓 drawimage = image1.copy() # ###注意不要对原图进行操作 res = cv2.drawContours(drawimage,contours,-1,(0,0,255),2) res_rgb = cv2.cvtColor(res, cv2.COLOR_BGR2RGB) # 关键步骤：BGR转RGB plt.subplot(),plt.imshow(res_rgb),plt.title(&#39;绘制轮廓&#39;) plt.show() # 进一步可以调用轮廓的各种特征 轮廓近似 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 import numpy as np import cv2 from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() import cv2 from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/lunkuo.png&#34;) # 图像预处理 gray1 = cv2.cvtColor(image1,cv2.COLOR_BGR2GRAY) a,image2 = cv2.threshold(gray1,127,255,cv2.THRESH_BINARY) binary,contours,hierarchy = cv2.findContours(image2,cv2.RETR_TREE,cv2.CHAIN_APPROX_NONE) cont = contours[0] #检测到的第一个轮廓 epsilon = 0.1*cv2.arcLength(cont,True) approx = cv2.approxPolyDP(cont,epsilon,True) image3 = image1.copy() res = cv2.drawContours(image3,[approx],-1,(0,0,255),2) # 外接矩形 x,y,w,h = cv2.boundingRect(cont) image4 = image1.copy() image4 = cv2.rectangle(image4,(x,y),(x+w,y+h),(0,0,255),2) # 外接圆 (x,y),radius = cv2.minEnclosingCircle(cont) center = (int(x),int(y)) radius= int(radius) image5 = cv2.circle(image1,center,radius,(0,0,255),2) image = hstack((res,image4,image5)) cvshow(image) 图像匹配 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 import numpy as np import cv2 from cv2 import TM_CCORR, TM_CCORR_NORMED, TM_SQDIFF, TM_SQDIFF_NORMED from numpy.ma import hstack from numpy.ma import vstack def cvshow(img): cv2.imshow(&#34;image&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1=cv2.imread(r&#34;./pictures/GEM.png&#34;,0) image2=cv2.imread(r&#34;./pictures/GEM_face.png&#34;,0) image3 = image1.copy() h,w = image2.shape[:2] &#34;&#34;&#34; cv2.IMREAD_COLOR (1)：加载彩色图像，忽略透明度。 cv2.IMREAD_GRAYSCALE (0)：以灰度模式加载图像。 cv2.IMREAD_UNCHANGED (-1)：加载图像包含alpha通道。 &#34;&#34;&#34; res = cv2.matchTemplate(image1,image2,TM_CCORR_NORMED) a,b,c,d = cv2.minMaxLoc(res) youxia = (d[0]+w,d[1]+h) image = cv2.rectangle(image3,d,youxia,(0,255,0),2) cvshow(image) 直方图 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 %matplotlib inline import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image1 = cv2.imread(&#34;./pictures/GEM.png&#34;) image1_gray = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY) # 计算灰度直方图（OpenCV方式） hist = cv2.calcHist([image1_gray], [0], None, [256], [0, 256]) # 将直方图数据转换为可绘制的形式 plt.figure(figsize=(10, 2)) plt.plot(hist, color=&#39;blue&#39;) # 用曲线绘制直方图 # 或使用柱状图： # plt.bar(range(256), hist.ravel(), color=&#39;gray&#39;, width=1.0) # 设置图表属性 plt.title(&#34;灰度直方图（基于cv2.calcHist）&#34;),plt.xlabel(&#34;像素值 (0-255)&#34;),plt.ylabel(&#34;频次&#34;),plt.xlim([0, 255]) # 限制X轴范围 plt.grid(alpha=1) # 表示网格线是半透明的（30% 不透明） plt.show() # 分别统计这张彩色图的b、g、r plt.figure(figsize=(10, 2)) color = (&#39;b&#39;,&#39;g&#39;,&#39;r&#39;) # 通过for循环，将不同颜色进行统计，绘制在三张图上，最后将三张图统一展示。 for i, col in enumerate(color): # enumerate可以同时得到索引和数据 hist = cv2.calcHist([image1], [i], None, [256], [0, 256]) plt.plot(hist, color=col) plt.xlim([0, 256]) plt.show() musk的使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 %matplotlib inline import numpy as np import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image= cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE) musk = np.zeros(image.shape[:2],np.uint8) musk[100:300,100:400] = 255 # 把保存的东西设置为255 hist = cv2.calcHist([image],[0],musk,[256],[0,256]) plt.figure(figsize=(10, 2)) plt.plot(hist) plt.xlim([0,256]) plt.show() 均衡化与自适应均衡化 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import numpy as np import cv2 import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image= cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE) musk = np.zeros(image.shape[:2],np.uint8) musk[100:300,100:400] = 255 hist = cv2.calcHist([image],[0],musk,[256],[0,256]) a = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8,8)) res_clahe = a.apply(image) equ = cv2.equalizeHist(image) plt.figure(figsize=(8, 2)) plt.subplot(122),plt.imshow(res_clahe,cmap=&#39;gray&#39;),plt.title(&#34;自适应均衡化&#34;) plt.subplot(121),plt.imshow(equ,cmap=&#39;gray&#39;),plt.title(&#34;均衡化&#34;) plt.show() 低通与高通滤波 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 import cv2 import numpy as np import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False image = cv2.imread(&#39;./pictures/GEM.png&#39;, cv2.IMREAD_GRAYSCALE)#读取图像 image_float32 = np.float32(image) # 转化格式为np.float32 a = cv2.dft(image_float32, flags=cv2.DFT_COMPLEX_OUTPUT) # 进行频域变化 a_shift = np.fft.fftshift(a) # 将低频值放到中心处 img2 = 20*np.log(cv2.magnitude(a_shift[:,:,0], a_shift[:,:,1])) # 转化为灰度图可以展示的图像 rows, cols = image.shape crow, ccol = int(rows / 2), int(cols / 2) # 低通滤波器(会使得图像变模糊) musk = np.zeros((rows, cols,2),np.uint8) musk[crow-30:crow+30, ccol-30:ccol+30] = 1 # IDFT fshift = a_shift*musk f_shift = np.fft.ifftshift(fshift) # 还原这一步操作：“将低频值放到中心处” img = cv2.idft(f_shift) img = cv2.magnitude(img[:,:,0], img[:,:,1]) # 把实部与虚部分开 # 高通滤波器 musk2 = np.ones((rows, cols,2),np.uint8) musk2[crow-30:crow+30, ccol-30:ccol+30] = 0 fshift2 = a_shift*musk2 f_shift2 = np.fft.ifftshift(fshift2) img2 = cv2.idft(f_shift2) img2 = cv2.magnitude(img2[:,:,0], img2[:,:,1]) plt.subplot(221),plt.imshow(img2, cmap=&#39;gray&#39;),plt.title(&#34;频域图&#34;) plt.subplot(222),plt.imshow(image, cmap=&#39;gray&#39;),plt.title(&#34;原始图像&#34;) plt.subplot(223),plt.imshow(img, cmap=&#39;gray&#39;),plt.title(&#34;低通滤波器&#34;) plt.subplot(224),plt.imshow(img2, cmap=&#39;gray&#39;),plt.title(&#34;高通滤波器&#34;) plt.show() 角点检测 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt # 设置中文字体 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image = cv2.imread(&#34;./pictures/guojixiangqi_qipan.jpg&#34;) image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) image_gray_32 = np.float32(image_gray) # ！！！注意要求把灰度图转化为np.float32格式的，这很重要！！！ dst = cv2.cornerHarris(image_gray_32, 2, 3, 0.04) # 固定用法 image[dst &gt; 0.01 * dst.max()] = [0, 0, 255] # 固定用法，用于筛选出响应值大于最大响应值 1% 的像素点，这些像素点被认为是角点 plt.imshow(image),plt.title(&#34;角点检测&#34;) plt.show() .SIFT函数检测特征点 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() # 图像读取与预处理 image = cv2.imread(&#34;./pictures/GEM.png&#34;) image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) # 得到特征点（key points） sift = cv2.xfeatures2d.SIFT_create() kp = sift.detect(image_gray, None) # 传入的是灰度图 # 绘制特征点 image = cv2.drawKeypoints(image_gray, kp, image, color=(0, 255, 0)) # 输出图片 plt.subplot(),plt.imshow(image, cmap=&#39;gray&#39;),plt.title(&#34;SIFT特征点&#34;),plt.show() # 计算特征 kp,des = sift.compute(image_gray, kp) print(np.array(kp).shape) # 特征点的个数 print(des.shape) # 每一个特征点都是一个128维的向量 print(des[0]) # 每一个特征点都是一个128维的向量，可以数一下是128维 Brute-Force蛮力匹配 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 %matplotlib inline import numpy as np import matplotlib.pyplot as plt import cv2 plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False def show(img): cv2.imshow(&#34;topic:zhenquanxu1&#34;, img) cv2.waitKey(0) cv2.destroyAllWindows() image1 = cv2.imread(&#34;./pictures/GEM_face.png&#34;) image2 = cv2.imread(&#34;./pictures/GEM.png&#34;) sift = cv2.xfeatures2d.SIFT_create() kp1, des1 = sift.detectAndCompute(image1, None) # 找到特征点与特征向量 kp2, des2 = sift.detectAndCompute(image2, None) # 找到特征点与特征向量 bf1 = cv2.BFMatcher(crossCheck=True) # 1对1的匹配 matches = bf1.match(des1, des2) matches = sorted(matches, key=lambda x: x.distance) image3 = cv2.drawMatches(image1, kp1, image2, kp2, matches[:10], None, flags=2) # k对最佳匹配 bf2 = cv2.BFMatcher() matches2 = bf2.knnMatch(des1,des2,2) good = [] for m, n in matches2: if m.distance &lt; 0.75*n.distance: good.append(m) image4 = cv2.drawMatches(image1, kp1, image2, kp2, good, None, flags=2) # 展示图片 image3_rgb = image3[:, :, ::-1] # 把BGR图片转化为RGB图片 image4_rgb = image4[:, :, ::-1] # 把BGR图片转化为RGB图片 plt.subplot(221),plt.imshow(image3_rgb),plt.title(&#34;1对1的匹配&#34;) plt.subplot(222),plt.imshow(image4_rgb),plt.title(&#34;k对最佳匹配&#34;) plt.show() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 %matplotlib inline import cv2 import numpy as np import matplotlib.pyplot as plt plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False imageA = cv2.imread(&#34;./pictures/p1.png&#34;) imageB = cv2.imread(&#34;./pictures/p2.png&#34;) gray1 = cv2.cvtColor(imageA, cv2.COLOR_BGR2GRAY) gray2 = cv2.cvtColor(imageB, cv2.COLOR_BGR2GRAY) sift = cv2.xfeatures2d.SIFT_create() kpsA,dpA = sift.detectAndCompute(gray1, None) kpsB,dpB = sift.detectAndCompute(gray2, None) bf = cv2.BFMatcher() matches = bf.knnMatch(dpA,dpB,2) good = [] for m in matches: if len(m) == 2 and m[0].distance &lt; m[1].distance * 0.75: good.append((m[0].queryIdx,m[0].trainIdx)) kps1 = np.float32([kp.pt for kp in kpsA]) kps2 = np.float32([kp.pt for kp in kpsB]) kps1 = np.float32([kps1[a[0]] for a in good]) kps2 = np.float32([kps2[a[1]] for a in good]) M,status = cv2.findHomography(kps2,kps1,cv2.RANSAC,4.0) result = cv2.warpPerspective(imageB, M, (imageA.shape[1]+imageB.shape[1],imageA.shape[0])) result[0:imageA.shape[0],0:imageA.shape[1]] = imageA # 计算变换后的图像B的边界 h, w = imageB.shape[:2] corners = np.array([[0, 0], [0, h-1], [w-1, h-1], [w-1, 0]], dtype=np.float32) warped_corners = cv2.perspectiveTransform(corners.reshape(1, -1, 2), M).reshape(-1, 2) # 计算输出画布的最小包围矩形 all_corners = np.concatenate((warped_corners, np.array([[0,0], [imageA.shape[1], imageA.shape[0]]])), axis=0) x_min, y_min = np.floor(np.min(all_corners, axis=0)).astype(int) x_max, y_max = np.ceil(np.max(all_corners, axis=0)).astype(int) # 计算平移变换矩阵 offset_x = -x_min offset_y = -y_min translation_matrix = np.array([[1, 0, offset_x], [0, 1, offset_y], [0, 0, 1]]) # 调整单应性矩阵并执行透视变换 adjusted_homography = translation_matrix.dot(M) result = cv2.warpPerspective(imageB, adjusted_homography, (x_max - x_min, y_max - y_min)) # 创建新的拼接画布 result[offset_y:offset_y+imageA.shape[0], offset_x:offset_x+imageA.shape[1]] = imageA # 自动裁剪黑边 gray = cv2.cvtColor(result, cv2.COLOR_BGR2GRAY) _, thresh = cv2.threshold(gray, 1, 255, cv2.THRESH_BINARY) _,contours, _ = cv2.findContours(thresh, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE) x,y,w,h = cv2.boundingRect(contours[0]) final = result[y:y+h, x:x+w] # 展示图片 final_rgb = final[:, :, ::-1] # 把BGR图片转化为RGB图片 imageA_rgb = imageA[:, :, ::-1]# 把BGR图片转化为RGB图片 imageB_rgb = imageB[:, :, ::-1]# 把BGR图片转化为RGB图片 plt.subplot(131),plt.imshow(imageA_rgb),plt.title(&#34;左边的图片&#34;) plt.subplot(132),plt.imshow(imageB_rgb),plt.title(&#34;右边的图片&#34;) plt.subplot(133),plt.imshow(final_rgb),plt.title(&#34;拼接后的图片&#34;) plt.show() ">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/face_hu_5db5837227a9da45.jpg" width="300"
                            height="280" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">胥振泉</a></h1>
            <h2 class="site-description">欢迎来看我呀！</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>档案</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>检索</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#图像读取">图像读取</a></li>
    <li><a href="#视频读取">视频读取</a></li>
    <li><a href="#图像的灰度处理截取颜色通道的提取调整大小与融合阈值">图像的灰度处理、截取、颜色通道的提取、调整大小与融合、阈值</a></li>
    <li><a href="#边界填充">边界填充</a></li>
    <li><a href="#数值计算">数值计算</a></li>
    <li><a href="#6图像平滑处理滤波处理">图像平滑处理（滤波处理）</a></li>
    <li><a href="#7腐蚀与膨胀及其组合开运算闭运算梯度运算礼帽与黑帽">腐蚀与膨胀及其组合（开运算、闭运算、梯度运算、礼帽与黑帽）</a></li>
    <li><a href="#8图像梯度计算">图像梯度计算</a></li>
    <li><a href="#9canny边缘检测">canny边缘检测</a></li>
    <li><a href="#10图像金字塔">图像金字塔</a></li>
    <li><a href="#图像轮廓">图像轮廓</a></li>
    <li><a href="#轮廓近似">轮廓近似</a></li>
    <li><a href="#图像匹配">图像匹配</a></li>
    <li><a href="#直方图">直方图</a>
      <ol>
        <li><a href="#musk的使用">musk的使用</a></li>
        <li><a href="#均衡化与自适应均衡化">均衡化与自适应均衡化</a></li>
      </ol>
    </li>
    <li><a href="#低通与高通滤波">低通与高通滤波</a></li>
    <li><a href="#角点检测">角点检测</a></li>
    <li><a href="#sift函数检测特征点">.SIFT函数检测特征点</a>
      <ol>
        <li><a href="#brute-force蛮力匹配">Brute-Force蛮力匹配</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/opencv/" >
                Opencv
            </a>
        
            <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" >
                机器学习
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/opencv%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">opencv学习笔记</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-04-13</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 11 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="图像读取">图像读取
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 导包</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">hstack</span><span class="c1"># 用于横向拼接图片</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">vstack</span><span class="c1"># 用于纵向拼接图片</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cv_show</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;topic:zhenquanxu1&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>    
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/plane.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/plane.jpg&#34;</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cv_show</span><span class="p">(</span><span class="n">image2</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="视频读取">视频读取
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="n">vc</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;C:\Users\zhenq\Videos\03.mp4&#34;</span><span class="p">)</span>  <span class="c1"># 图像的读取</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 异常处理</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">vc</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">oepn</span><span class="p">,</span><span class="n">frame</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">open</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用循环体对每一帧图像进行读取</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nb">open</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># frame位置是帧，如果视频没有了，frame变为None,视频退出播放</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  ret 表示程序能否读取视频</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;这是一个测试&#34;</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">))</span><span class="c1"># 对每一帧进行灰度处理</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xFF</span><span class="o">==</span><span class="mi">27</span><span class="p">:</span> <span class="c1"># 程序等待10毫秒，在这个时间内检测用户键盘输入，esc的ASCII码是27.检测后进入下一次的while循环</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl"><span class="n">vc</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="图像的灰度处理截取颜色通道的提取调整大小与融合阈值">图像的灰度处理、截取、颜色通道的提取、调整大小与融合、阈值
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cv_show</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;topic:zhenquanxu1&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 图像的灰度处理方法一：在imread中添加相关参数，这钟方法不建议使用，此处不再写</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 图像的灰度处理方法二：将传入的图像进行二次处理,这种方法可以分别得到原图和灰度图，方便展示</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/GEM.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">截取图像，在使用imread后，得到的是一个矩阵（或者说是一个list[]列表），可以使用切片的方法从里面得到部分数据
</span></span></span><span class="line"><span class="cl"><span class="s2">对于BGR彩色图，这个list是一个&#34;[[[B,G,R]]]&#34;,比如下面这个3*3的图片
</span></span></span><span class="line"><span class="cl"><span class="s2">[[[ 62  62  62]
</span></span></span><span class="line"><span class="cl"><span class="s2">  [ 56  56  56]
</span></span></span><span class="line"><span class="cl"><span class="s2">  [ 33  33  33]]
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"> [[126 126 126]
</span></span></span><span class="line"><span class="cl"><span class="s2">  [ 58  58  58]
</span></span></span><span class="line"><span class="cl"><span class="s2">  [ 57  57  57]]
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"> [[ 61  61  61]
</span></span></span><span class="line"><span class="cl"><span class="s2">  [ 94  94  94]
</span></span></span><span class="line"><span class="cl"><span class="s2">  [217 217 217]]]
</span></span></span><span class="line"><span class="cl"><span class="s2">可以横向进行表示，更容易理解：
</span></span></span><span class="line"><span class="cl"><span class="s2">[[[ 62  62  62],[ 56  56  56],[ 33  33  33]]
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"> [[126 126 126],[ 58  58  58],[ 57  57  57]]
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"> [[ 61  61  61],[ 94  94  94],[217 217 217]]]
</span></span></span><span class="line"><span class="cl"><span class="s2">list[0:2]可以把0行、1行拿出来，也就是列表中的第一行和第二行
</span></span></span><span class="line"><span class="cl"><span class="s2">list[0:2][0:1]可以把列表中前两行、第一列列拿出来。当然了list[0:2,0:1]和list[0:2][0:1]是一样的。
</span></span></span><span class="line"><span class="cl"><span class="s2">进一步的说[0:2]是图片的高，[0:1]是图片的宽。在cv2中图像的坐标原点在左上角，水平方向是w轴，竖直方向是h，要理解图像和矩阵之间的转换关系。
</span></span></span><span class="line"><span class="cl"><span class="s2">每一个像素点由三个数字表示；对于灰度图，一个数字就可以表示一个像素点。
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 在理解了图像和矩阵或者说列表之间的关系，下面的就很好理解了。对列表进行三次切片可以得到相应的BGR颜色值。</span>
</span></span><span class="line"><span class="cl"><span class="c1">#只保留R.注意在cv2中顺序是BGR，不是RGB</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">cv2.resize(image1,(100,100))                #调整大小为100*100
</span></span></span><span class="line"><span class="cl"><span class="s2">cv2.resize(image1,(0,0),fx=2,fy=2)          #图像沿着x方向y方向进行拉伸
</span></span></span><span class="line"><span class="cl"><span class="s2">cv2.addWeighted(image,0.5,image1,0.5,0)     #res=A*image+B*image1+C,在这里A,B,C分别是0.5，0.5，0
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="边界填充">边界填充
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> 
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;this is a top&#34;</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/03.png&#34;</span><span class="p">)</span><span class="c1"># 图片大小(746, 1374, 3)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 为了进行边界填充，首先将图片进行切割。</span>
</span></span><span class="line"><span class="cl"><span class="n">image2</span> <span class="o">=</span> <span class="n">image1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 边界填充</span>
</span></span><span class="line"><span class="cl"><span class="n">top</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span> <span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1.replicate法填充</span>
</span></span><span class="line"><span class="cl"><span class="n">replicate</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">top</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REPLICATE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2.reflect 法填充</span>
</span></span><span class="line"><span class="cl"><span class="n">reflect</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">top</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3.reflect101 法填充</span>
</span></span><span class="line"><span class="cl"><span class="n">reflect101</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">top</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4.wrap法填充</span>
</span></span><span class="line"><span class="cl"><span class="n">wrap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">top</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_WRAP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 5.constant法填充</span>
</span></span><span class="line"><span class="cl"><span class="n">constant</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">top</span><span class="p">,</span><span class="n">bottom</span><span class="p">,</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">borderType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#图片展示，其中&#34;231&#34;，2表示总行数；3表示总列数；1表示这六个位置中的第一个位置。</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">231</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">replicate</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;replicate法填充&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">232</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reflect</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;reflect法填充&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">233</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reflect101</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;reflect101法填充&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">234</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wrap</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;wrap法填充&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">235</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">constant</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;constant法填充&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="数值计算">数值计算
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/opencv_logo.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/plane.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">image2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">250</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">250</span><span class="p">]</span>  <span class="c1"># 使image与image1大小相同，以保证矩阵能正常进行运算</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fun1</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">image2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">250</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">250</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;6&#34;</span><span class="p">,</span><span class="n">image</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># 将矩阵中的每一个数字加100</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;6&#34;</span><span class="p">,</span><span class="n">image</span><span class="o">+</span><span class="n">image1</span><span class="p">)</span> <span class="c1"># 大小相同的两个矩阵相加，超过255的部分取余数</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>        <span class="c1">#大小相同的两个矩阵相加，超过255的统一取为255</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6图像平滑处理滤波处理">图像平滑处理（滤波处理）
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/bad.png&#34;</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 均值滤波</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">image1</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 方框滤波</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow2</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">boxFilter</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1"># 效果同上均值滤波</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow3</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">boxFilter</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1"># 越界了</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 高斯滤波</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow4</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">image1</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 中值滤波</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow5</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">medianBlur</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">231</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cvshow1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;均值滤波&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">232</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cvshow2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;方框滤波_normalize=True&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">233</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cvshow3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;方框滤波_normalize=False&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">234</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cvshow4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;高斯滤波&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">235</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cvshow5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;中值滤波&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7腐蚀与膨胀及其组合开运算闭运算梯度运算礼帽与黑帽">腐蚀与膨胀及其组合（开运算、闭运算、梯度运算、礼帽与黑帽）
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">腐蚀与膨胀操作用于处理二值化的图像，由于大多数图片都是BGR三色的
</span></span></span><span class="line"><span class="cl"><span class="s2">下面写一个函数，将BGR图片处理为二值化图片
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">img_twonum</span><span class="p">(</span><span class="n">image1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span><span class="c1">#确保图像是灰度图</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dst</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/fushi.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image2</span> <span class="o">=</span> <span class="n">img_twonum</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#用 NumPy 库创建一个 5x5 的全1矩阵（内核/结构元素），数据类型为无符号8位整数（取值范围 0-255）</span>
</span></span><span class="line"><span class="cl"><span class="n">erosion</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">erode</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                 <span class="c1"># 腐蚀 # 最后的参数表示迭代次数</span>
</span></span><span class="line"><span class="cl"><span class="n">dilt</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">kernel</span><span class="p">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                   <span class="c1"># 膨胀</span>
</span></span><span class="line"><span class="cl"><span class="n">opening</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_OPEN</span><span class="p">,</span><span class="n">kernel</span><span class="p">)</span>        <span class="c1"># 开运算:先腐蚀再膨胀</span>
</span></span><span class="line"><span class="cl"><span class="n">close</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_CLOSE</span><span class="p">,</span><span class="n">kernel</span><span class="p">)</span>         <span class="c1"># 闭运算:先膨胀再腐蚀</span>
</span></span><span class="line"><span class="cl"><span class="n">gradient</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_GRADIENT</span><span class="p">,</span><span class="n">kernel</span><span class="p">)</span>   <span class="c1"># 梯度运算= 膨胀-腐蚀。得到边缘信息</span>
</span></span><span class="line"><span class="cl"><span class="n">tophat</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_TOPHAT</span><span class="p">,</span><span class="n">kernel</span><span class="p">)</span>       <span class="c1"># 礼帽= 原始输入-开运算 得到的是刺</span>
</span></span><span class="line"><span class="cl"><span class="n">blackhat</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">morphologyEx</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">MORPH_BLACKHAT</span><span class="p">,</span><span class="n">kernel</span><span class="p">)</span>   <span class="c1"># 黑帽 = 闭运算-原始输入 得到的是主体大概的轮廓</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">241</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">erosion</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;腐蚀&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">242</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dilt</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;膨胀&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">243</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">opening</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;开运算:先腐蚀再膨胀&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">244</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">close</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;闭运算:先膨胀再腐蚀&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">245</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;梯度运算= 膨胀-腐蚀&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">246</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tophat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;礼帽=原始输入-开运算&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">247</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blackhat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;黑帽=闭运算-原始输入&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="8图像梯度计算">图像梯度计算
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">求梯度多用于灰度图片
</span></span></span><span class="line"><span class="cl"><span class="s2">但是不建议把dx,dx同时设置为1别计算，应该把dx、dy分开求出来，再进行融合
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;topic:zhenquanxu1&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">juedui</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>   <span class="c1"># 用于矩阵求绝对值</span>
</span></span><span class="line"><span class="cl">    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">img</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/pie.png&#34;</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sobel算子,分别计算x和y方向的一阶梯度，合并后显示边缘</span>
</span></span><span class="line"><span class="cl"><span class="n">sobelx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_64F</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ksize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sobely</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_64F</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ksize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># scharr算子,类似Sobel，但对边缘更敏感</span>
</span></span><span class="line"><span class="cl"><span class="n">scharrx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Scharr</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_64F</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">scharry</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Scharr</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_64F</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Laplacian算子,显示二阶导数边缘，通常比一阶算子对噪声更敏感，边缘更细,不能分开求</span>
</span></span><span class="line"><span class="cl"><span class="n">laplacian</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Laplacian</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CV_64F</span><span class="p">,</span><span class="n">ksize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 分别对每个梯度图像求绝对值</span>
</span></span><span class="line"><span class="cl"><span class="n">sobelx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">sobelx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sobely</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">sobely</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">scharrx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">scharrx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">scharry</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">scharry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">laplacian</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">laplacian</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 求两个方向的梯度</span>
</span></span><span class="line"><span class="cl"><span class="n">sobelxy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">sobelx</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">sobely</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">scharrxy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">scharrx</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">scharry</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sobelxy</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;sobel算子&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scharrxy</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;scharr算子,类似Sobel，但对边缘更敏感&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">laplacian</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Laplacian算子,显示二阶导数边缘&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="9canny边缘检测">canny边缘检测
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/bad.png&#34;</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v1</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>  <span class="c1"># 分别指的是maxval,minval</span>
</span></span><span class="line"><span class="cl"><span class="n">v2</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v3</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v4</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v5</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v6</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v7</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">v8</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">201</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">241</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_10*150&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">242</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_30*150&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">243</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_50*150&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">244</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_50*51&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">245</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_50*100&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">246</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_50*200&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">247</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_145*150&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">248</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v8</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;canny_200*201&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="10图像金字塔">图像金字塔
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 高斯金字塔</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/AM.png&#34;</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">up1</span> <span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">pyrUp</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>    <span class="c1">#图像变大</span>
</span></span><span class="line"><span class="cl"><span class="n">up2</span> <span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">pyrDown</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>  <span class="c1">#图像变大小</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 拉普拉斯金字塔</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">laplasi</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/AM.png&#34;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">down</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">pyrDown</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">down_up</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">pyrUp</span><span class="p">(</span><span class="n">down</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">image1</span><span class="o">-</span><span class="n">down_up</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 这个拉普拉斯金字塔只迭代了1次</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/AM.png&#34;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># 这里可以设置迭代次数</span>
</span></span><span class="line"><span class="cl">    <span class="n">down</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">pyrDown</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">down_up</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">pyrUp</span><span class="p">(</span><span class="n">down</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">image1</span> <span class="o">=</span> <span class="n">image1</span><span class="o">-</span><span class="n">down_up</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">up1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;高斯金字塔_up&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">up2</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;高斯金字塔_down&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;拉普拉斯金字塔&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="图像轮廓">图像轮廓
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/cars.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span><span class="n">image1_1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">binary</span><span class="p">,</span><span class="n">contours</span><span class="p">,</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">image1_1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 绘制轮廓</span>
</span></span><span class="line"><span class="cl"><span class="n">drawimage</span> <span class="o">=</span> <span class="n">image1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#  ###注意不要对原图进行操作</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">drawimage</span><span class="p">,</span><span class="n">contours</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>  <span class="c1"># 关键步骤：BGR转RGB</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res_rgb</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;绘制轮廓&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 进一步可以调用轮廓的各种特征</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="轮廓近似">轮廓近似
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">hstack</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">vstack</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">hstack</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">vstack</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/lunkuo.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 图像预处理</span>
</span></span><span class="line"><span class="cl"><span class="n">gray1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span><span class="n">image2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray1</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">binary</span><span class="p">,</span><span class="n">contours</span><span class="p">,</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cont</span> <span class="o">=</span> <span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#检测到的第一个轮廓</span>
</span></span><span class="line"><span class="cl"><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">cv2</span><span class="o">.</span><span class="n">arcLength</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">approx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">approxPolyDP</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image3</span> <span class="o">=</span> <span class="n">image1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">image3</span><span class="p">,[</span><span class="n">approx</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 外接矩形</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image4</span> <span class="o">=</span> <span class="n">image1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image4</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image4</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 外接圆</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">radius</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minEnclosingCircle</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">radius</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image5</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">center</span><span class="p">,</span><span class="n">radius</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">res</span><span class="p">,</span><span class="n">image4</span><span class="p">,</span><span class="n">image5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="图像匹配">图像匹配
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cv2</span> <span class="kn">import</span> <span class="n">TM_CCORR</span><span class="p">,</span> <span class="n">TM_CCORR_NORMED</span><span class="p">,</span> <span class="n">TM_SQDIFF</span><span class="p">,</span> <span class="n">TM_SQDIFF_NORMED</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">hstack</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">vstack</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cvshow</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;image&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/GEM.png&#34;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image2</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;./pictures/GEM_face.png&#34;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image3</span> <span class="o">=</span> <span class="n">image1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="n">image2</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">cv2.IMREAD_COLOR (1)：加载彩色图像，忽略透明度。
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">cv2.IMREAD_GRAYSCALE (0)：以灰度模式加载图像。
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">cv2.IMREAD_UNCHANGED (-1)：加载图像包含alpha通道。
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span><span class="n">image2</span><span class="p">,</span><span class="n">TM_CCORR_NORMED</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minMaxLoc</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">youxia</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image3</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">youxia</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cvshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="直方图">直方图
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 设置中文字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/GEM.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image1_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 计算灰度直方图（OpenCV方式）</span>
</span></span><span class="line"><span class="cl"><span class="n">hist</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">image1_gray</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 将直方图数据转换为可绘制的形式</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>  <span class="c1"># 用曲线绘制直方图</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 或使用柱状图：</span>
</span></span><span class="line"><span class="cl"><span class="c1"># plt.bar(range(256), hist.ravel(), color=&#39;gray&#39;, width=1.0)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 设置图表属性</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;灰度直方图（基于cv2.calcHist）&#34;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;像素值 (0-255)&#34;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;频次&#34;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>  <span class="c1"># 限制X轴范围</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 表示网格线是半透明的（30% 不透明）</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 分别统计这张彩色图的b、g、r</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 通过for循环，将不同颜色进行统计，绘制在三张图上，最后将三张图统一展示。</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">color</span><span class="p">):</span> <span class="c1"># enumerate可以同时得到索引和数据</span>
</span></span><span class="line"><span class="cl">    <span class="n">hist</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">image1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="musk的使用">musk的使用
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 设置中文字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./pictures/GEM.png&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span><span class="mi">100</span><span class="p">:</span><span class="mi">400</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># 把保存的东西设置为255</span>
</span></span><span class="line"><span class="cl"><span class="n">hist</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">image</span><span class="p">],[</span><span class="mi">0</span><span class="p">],</span><span class="n">musk</span><span class="p">,[</span><span class="mi">256</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="均衡化与自适应均衡化">均衡化与自适应均衡化
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 设置中文字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./pictures/GEM.png&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span><span class="mi">100</span><span class="p">:</span><span class="mi">400</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
</span></span><span class="line"><span class="cl"><span class="n">hist</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">calcHist</span><span class="p">([</span><span class="n">image</span><span class="p">],[</span><span class="mi">0</span><span class="p">],</span><span class="n">musk</span><span class="p">,[</span><span class="mi">256</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createCLAHE</span><span class="p">(</span><span class="n">clipLimit</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">tileGridSize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">res_clahe</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">equ</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">equalizeHist</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res_clahe</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;自适应均衡化&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">equ</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;均衡化&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="低通与高通滤波">低通与高通滤波
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 设置中文字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;./pictures/GEM.png&#39;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span><span class="c1">#读取图像</span>
</span></span><span class="line"><span class="cl"><span class="n">image_float32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>   <span class="c1"># 转化格式为np.float32</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dft</span><span class="p">(</span><span class="n">image_float32</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">DFT_COMPLEX_OUTPUT</span><span class="p">)</span> <span class="c1"># 进行频域变化</span>
</span></span><span class="line"><span class="cl"><span class="n">a_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   <span class="c1"># 将低频值放到中心处</span>
</span></span><span class="line"><span class="cl"><span class="n">img2</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">magnitude</span><span class="p">(</span><span class="n">a_shift</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">a_shift</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># 转化为灰度图可以展示的图像</span>
</span></span><span class="line"><span class="cl"><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>
</span></span><span class="line"><span class="cl"><span class="n">crow</span><span class="p">,</span> <span class="n">ccol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 低通滤波器(会使得图像变模糊)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk</span><span class="p">[</span><span class="n">crow</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">crow</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">ccol</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">ccol</span><span class="o">+</span><span class="mi">30</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># IDFT</span>
</span></span><span class="line"><span class="cl"><span class="n">fshift</span> <span class="o">=</span> <span class="n">a_shift</span><span class="o">*</span><span class="n">musk</span>
</span></span><span class="line"><span class="cl"><span class="n">f_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">fshift</span><span class="p">)</span> <span class="c1"># 还原这一步操作：“将低频值放到中心处”</span>
</span></span><span class="line"><span class="cl"><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">idft</span><span class="p">(</span><span class="n">f_shift</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">magnitude</span><span class="p">(</span><span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># 把实部与虚部分开</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 高通滤波器</span>
</span></span><span class="line"><span class="cl"><span class="n">musk2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">musk2</span><span class="p">[</span><span class="n">crow</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">crow</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">ccol</span><span class="o">-</span><span class="mi">30</span><span class="p">:</span><span class="n">ccol</span><span class="o">+</span><span class="mi">30</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">fshift2</span> <span class="o">=</span> <span class="n">a_shift</span><span class="o">*</span><span class="n">musk2</span>
</span></span><span class="line"><span class="cl"><span class="n">f_shift2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">fshift2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">idft</span><span class="p">(</span><span class="n">f_shift2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">magnitude</span><span class="p">(</span><span class="n">img2</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">img2</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;频域图&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;原始图像&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;低通滤波器&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;高通滤波器&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="角点检测">角点检测
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 设置中文字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;topic:zhenquanxu1&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/guojixiangqi_qipan.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">image_gray_32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">image_gray</span><span class="p">)</span>   <span class="c1"># ！！！注意要求把灰度图转化为np.float32格式的，这很重要！！！</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cornerHarris</span><span class="p">(</span><span class="n">image_gray_32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">)</span>   <span class="c1"># 固定用法</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span><span class="p">[</span><span class="n">dst</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>         <span class="c1"># 固定用法，用于筛选出响应值大于最大响应值 1% 的像素点，这些像素点被认为是角点</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;角点检测&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="sift函数检测特征点">.SIFT函数检测特征点
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;topic:zhenquanxu1&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 图像读取与预处理    </span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/GEM.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 得到特征点（key points）</span>
</span></span><span class="line"><span class="cl"><span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">xfeatures2d</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">kp</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">image_gray</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># 传入的是灰度图</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 绘制特征点</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawKeypoints</span><span class="p">(</span><span class="n">image_gray</span><span class="p">,</span> <span class="n">kp</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl"><span class="c1"># 输出图片</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;SIFT特征点&#34;</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 计算特征</span>
</span></span><span class="line"><span class="cl"><span class="n">kp</span><span class="p">,</span><span class="n">des</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">image_gray</span><span class="p">,</span> <span class="n">kp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># 特征点的个数</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">des</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>          <span class="c1"># 每一个特征点都是一个128维的向量</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">des</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>             <span class="c1"># 每一个特征点都是一个128维的向量，可以数一下是128维</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="brute-force蛮力匹配">Brute-Force蛮力匹配
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&#34;topic:zhenquanxu1&#34;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/GEM_face.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/GEM.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">xfeatures2d</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">kp1</span><span class="p">,</span> <span class="n">des1</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># 找到特征点与特征向量</span>
</span></span><span class="line"><span class="cl"><span class="n">kp2</span><span class="p">,</span> <span class="n">des2</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># 找到特征点与特征向量</span>
</span></span><span class="line"><span class="cl"><span class="n">bf1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1对1的匹配</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="o">=</span> <span class="n">bf1</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span> <span class="n">des2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image3</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span> <span class="n">matches</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># k对最佳匹配</span>
</span></span><span class="line"><span class="cl"><span class="n">bf2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">matches2</span> <span class="o">=</span> <span class="n">bf2</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">des1</span><span class="p">,</span><span class="n">des2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">good</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">matches2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">distance</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">good</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">image4</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">drawMatches</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">kp1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">kp2</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 展示图片</span>
</span></span><span class="line"><span class="cl"><span class="n">image3_rgb</span> <span class="o">=</span> <span class="n">image3</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># 把BGR图片转化为RGB图片</span>
</span></span><span class="line"><span class="cl"><span class="n">image4_rgb</span> <span class="o">=</span> <span class="n">image4</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># 把BGR图片转化为RGB图片</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image3_rgb</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;1对1的匹配&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image4_rgb</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;k对最佳匹配&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cv2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimHei&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.unicode_minus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">imageA</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/p1.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">imageB</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&#34;./pictures/p2.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gray1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">imageA</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gray2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">imageB</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sift</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">xfeatures2d</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">kpsA</span><span class="p">,</span><span class="n">dpA</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">kpsB</span><span class="p">,</span><span class="n">dpB</span> <span class="o">=</span> <span class="n">sift</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">gray2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">bf</span>  <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">matches</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">dpA</span><span class="p">,</span><span class="n">dpB</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">good</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">good</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">kps1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">kpsA</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">kps2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kp</span><span class="o">.</span><span class="n">pt</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">kpsB</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">kps1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kps1</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">good</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">kps2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([</span><span class="n">kps2</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">good</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="p">,</span><span class="n">status</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">kps2</span><span class="p">,</span><span class="n">kps1</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">,</span><span class="mf">4.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">imageB</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">(</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">imageB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">:</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">imageA</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 计算变换后的图像B的边界</span>
</span></span><span class="line"><span class="cl"><span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">imageB</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">warped_corners</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">corners</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 计算输出画布的最小包围矩形</span>
</span></span><span class="line"><span class="cl"><span class="n">all_corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">warped_corners</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_corners</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_corners</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 计算平移变换矩阵</span>
</span></span><span class="line"><span class="cl"><span class="n">offset_x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_min</span>
</span></span><span class="line"><span class="cl"><span class="n">offset_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y_min</span>
</span></span><span class="line"><span class="cl"><span class="n">translation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">offset_x</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 调整单应性矩阵并执行透视变换</span>
</span></span><span class="line"><span class="cl"><span class="n">adjusted_homography</span> <span class="o">=</span> <span class="n">translation_matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpPerspective</span><span class="p">(</span><span class="n">imageB</span><span class="p">,</span> <span class="n">adjusted_homography</span><span class="p">,</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 创建新的拼接画布</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="p">[</span><span class="n">offset_y</span><span class="p">:</span><span class="n">offset_y</span><span class="o">+</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">offset_x</span><span class="p">:</span><span class="n">offset_x</span><span class="o">+</span><span class="n">imageA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">imageA</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 自动裁剪黑边</span>
</span></span><span class="line"><span class="cl"><span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_</span><span class="p">,</span> <span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_</span><span class="p">,</span><span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contours</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">final</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 展示图片</span>
</span></span><span class="line"><span class="cl"><span class="n">final_rgb</span> <span class="o">=</span> <span class="n">final</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># 把BGR图片转化为RGB图片</span>
</span></span><span class="line"><span class="cl"><span class="n">imageA_rgb</span> <span class="o">=</span> <span class="n">imageA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1"># 把BGR图片转化为RGB图片</span>
</span></span><span class="line"><span class="cl"><span class="n">imageB_rgb</span> <span class="o">=</span> <span class="n">imageB</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1"># 把BGR图片转化为RGB图片</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imageA_rgb</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;左边的图片&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imageB_rgb</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;右边的图片&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">final_rgb</span><span class="p">),</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;拼接后的图片&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/opencv/">Opencv</a>
        
            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 zhenquanxu
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.a3b1b2f7e6934f93bc7dae4715734902531f7965bb6c78574ec3092de75d7a77.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
